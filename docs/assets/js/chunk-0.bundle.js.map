{"version":3,"sources":["webpack://pendora/./jekyll/js/pages/documentation/test_draggable.js","webpack://pendora/./src/core/ui/Draggable2.js"],"names":["TestDraggablePage","drag1","Draggable2","resistance","delay","scrollSpeed","container","ScrollArea","drag2","helper","clone","cursor","target","event","rect","Rect","x","clientX","left","y","clientY","top","element","axis","exclude","offset","handle","revert","revertDuration","selector","tolerance","setHelperSize","grid","document","querySelector","onMouseDown","addEventListener","startPosition","window","pageXOffset","pageYOffset","currentPosition","cancelMouseTracking","cancelTimer","closest","contains","Array","isArray","preventDefault","distanceBrokenPromise","Promise","resolve","isDistanceBroken","onMouseMove","calcDistance","removeEventListener","timerPromise","timer","setTimeout","clearTimeout","onMouseUp","all","timerStatus","distanceStatus","startDragging","offsetX","offsetY","startingX","startingY","pos","cancel","console","log","scroller","dropTargets","parentElement","appendChild","_moveElementToPosition","_selectElementRect","ScrollHelper","buildScrollHelper","currentDropTargets","getDropTargets","dropTarget","indexOf","_dispatchDropEvent","bubbles","details","originalEvent","accepted","accept","_revert","removeChild","undefined","mouseX","mouseY","initial","droppable","slice","Publisher","self","name","options","moveTo","translate","fit","setElementClientPosition","dragInstance","originalTarget","type","call","_getScrollParent","o","scrollWidth","clientWidth","scrollHeight","clientHeight","scrollXSpeed","scrollYSpeed","onFrame","frameID","timestamp","performance","now","frame","delta","scrollLeft","scrollTop","requestAnimationFrame","cancelAnimationFrame","scrollParentRect","r","right","clamp","width","bottom","scrollParent","speed","getScrollSpeed","scrollRect","scroll","getScroll","opacity","className","zIndex","nodeType","cloneNode","style","position"],"mappings":"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","file":"chunk-0.bundle.js","sourcesContent":["import Draggable2, {ScrollArea, clone} from \"core/ui/Draggable2\";\r\n\r\n\r\nexport default class TestDraggablePage {\r\n    load() {\r\n        this.drag1 = new Draggable2(\"#drag-example1\", {resistance: 0, delay: 0, scrollSpeed: 1000, container: ScrollArea('.example-zone')});\r\n        this.drag2 = new Draggable2(\"#drag-example2\", {resistance: 0, delay: 0, container: ScrollArea('#ez2'), helper: clone(0.5)});\r\n    }\r\n}\r\n","import Publisher from \"../Publisher\";\r\nimport {calcDistance, clamp} from \"../utility\";\r\nimport Rect from \"../vectors/Rect\";\r\nimport {getScroll} from \"../utility\";\r\nimport {setElementClientPosition} from \"./position\";\r\n\r\n\r\nexport function cursor(target, event) {\r\n    let rect = new Rect(target);\r\n\r\n    return {\r\n        x: event.clientX - rect.left,\r\n        y: event.clientY - rect.top\r\n    };\r\n}\r\n\r\n\r\nexport default class Draggable2 extends Publisher {\r\n    #element;\r\n    #droppables;\r\n    #boundOnMouseDown;\r\n    #revertFX;\r\n    #isDragging;\r\n\r\n    constructor(element, {container=null, axis='xy', exclude='', delay=0, offset=cursor,\r\n        resistance=0, handle=null, helper=null, revert=false, revertDuration=1000,\r\n        scrollSpeed=0, selector=null, tolerance='intersect', setHelperSize=false, grid=null}={}) {\r\n        super();\r\n\r\n        if(typeof element === 'string') {\r\n            this.#element = document.querySelector(element);\r\n        } else {\r\n            this.#element = element;\r\n        }\r\n\r\n        this.#droppables = [];\r\n        this.#revertFX = null;\r\n        this.#isDragging = false;\r\n\r\n        this.container = container;\r\n        this.axis = axis;\r\n        this.exclude = exclude;\r\n        this.delay = delay;\r\n        this.offset = offset;\r\n        this.resistance = resistance;\r\n        this.handle = handle;\r\n        this.helper = helper;\r\n        this.revert = revert;\r\n        this.revertDuration = revertDuration;\r\n        this.scrollSpeed = scrollSpeed;\r\n        this.selector = selector;\r\n        this.tolerance = tolerance;\r\n        this.setHelperSize = setHelperSize;\r\n        this.grid = grid;\r\n\r\n        if(typeof this.container === 'string') {\r\n            this.container = document.querySelector(this.container);\r\n        }\r\n\r\n        this.#boundOnMouseDown = event => {\r\n            return this.onMouseDown(event);\r\n        };\r\n\r\n        this.element.addEventListener('mousedown', this.#boundOnMouseDown);\r\n    }\r\n\r\n    /**\r\n     * Starts dragging if the correct elements have been targeted and delay and resistance have been meet.\r\n     *\r\n     * @param event\r\n     * @returns {Promise<void>}\r\n     */\r\n    async onMouseDown(event) {\r\n        let startPosition = {x: event.clientX + window.pageXOffset, y: event.clientY + window.pageYOffset},\r\n            currentPosition = {x: startPosition.x, y: startPosition.y},\r\n            target = this.#element,\r\n            cancelMouseTracking = null,\r\n            cancelTimer = null,\r\n            distanceBrokenPromise,\r\n            timerPromise,\r\n            offset;\r\n\r\n        // Only start dragging if a draggable child of the element is targeted.\r\n        // If selector is null then the entire element is draggable and should be the target.\r\n        if(this.selector) {\r\n            target = event.target.closest(this.selector);\r\n\r\n            if(!target || !this.#element.contains(target)) {\r\n                return;\r\n            }\r\n        }\r\n\r\n        // Only start dragging if the handle was targeted.\r\n        // If handle is null then the entire target is the handle.\r\n        if(this.handle) {\r\n            let handle = event.target.closest(this.handle);\r\n\r\n            if(!handle || !target.contains(handle)) {\r\n                return;\r\n            }\r\n        }\r\n\r\n        // If any excluded elements are targeted ignore the event.\r\n        if(this.exclude) {\r\n            let exclude = event.target.closest(this.exclude);\r\n\r\n            if(exclude && target.contains(exclude)) {\r\n                return;\r\n            }\r\n        }\r\n\r\n        // Find the offset of the event.\r\n        if(typeof this.offset === 'function') {\r\n            offset = this.offset(target, event);\r\n        } else if(Array.isArray(this.offset)) {\r\n            offset = {\r\n                x: this.offset[0],\r\n                y: this.offset[1]\r\n            };\r\n        } else if(typeof this.offset === 'object') {\r\n            offset = {\r\n                x: this.offset.x,\r\n                y: this.offset.y\r\n            };\r\n        } else {\r\n            offset = {x: 0, y: 0};\r\n        }\r\n\r\n        // Prevent default browser actions.\r\n        event.preventDefault();\r\n\r\n        // At this point we can be sure that a draggable item was\r\n        // targeted by it's handle and no excluded items where clicked.\r\n\r\n        // Creates a promise that both tracks the current mouse coords and resolve\r\n        // when the user passes the given resistance.\r\n        distanceBrokenPromise = new Promise(resolve => {\r\n            let isDistanceBroken = this.resistance <= 0;\r\n\r\n            if(isDistanceBroken) {\r\n                resolve('complete');\r\n            }\r\n\r\n            let onMouseMove = event => {\r\n                currentPosition.x = event.clientX + window.pageXOffset;\r\n                currentPosition.y = event.clientY + window.pageYOffset;\r\n                event.preventDefault();\r\n\r\n                if(!isDistanceBroken && calcDistance(currentPosition.x, currentPosition.y, startPosition.x, startPosition.y) > this.resistance) {\r\n                    resolve('complete');\r\n                    isDistanceBroken = true;\r\n                }\r\n            };\r\n\r\n            // Cancel mouse tracking and resolve the promise to canceled if hasn't already been resolve.\r\n            // This function must be called or their will be a memory leak before onMouseDown completes.\r\n            cancelMouseTracking = () => {\r\n                if(onMouseMove) {\r\n                    document.removeEventListener('mousemove', onMouseMove);\r\n\r\n                    if(!isDistanceBroken) {\r\n                        resolve('canceled');\r\n                    }\r\n\r\n                    onMouseMove = null;\r\n                }\r\n            };\r\n\r\n            document.addEventListener('mousemove', onMouseMove);\r\n        });\r\n\r\n        // Creates a promise that resolve when after the delay time passes or the user cancels the drag by\r\n        // releasing the mouse button.\r\n        timerPromise = new Promise(resolve => {\r\n            let timer = null;\r\n\r\n            if(this.delay >= 0) {\r\n                timer = setTimeout(() => {\r\n                    resolve(\"complete\");\r\n                    timer = null;\r\n                }, this.delay);\r\n            } else {\r\n                resolve('complete');\r\n            }\r\n\r\n            // cancel the timer and resolve it to canceled if it is still active.\r\n            cancelTimer = () => {\r\n                if(timer) {\r\n                    clearTimeout(timer);\r\n                    resolve('canceled');\r\n                }\r\n            };\r\n        });\r\n\r\n        // cancel the timer and mouse tracking if they are still active.\r\n        let onMouseUp = event => {\r\n            event.preventDefault();\r\n            cancelTimer();\r\n            cancelMouseTracking();\r\n            document.removeEventListener('mouseup', onMouseUp);\r\n        };\r\n\r\n        document.addEventListener('mouseup', onMouseUp);\r\n\r\n        // Wait until the delay time and distance have passed or failed.\r\n        let [timerStatus, distanceStatus] = await Promise.all([timerPromise, distanceBrokenPromise]);\r\n\r\n        // Ensure that mouse tracking has been canceled.\r\n        if(cancelMouseTracking) cancelMouseTracking();\r\n\r\n        // At this point both the timer and distance status should have passed or failed.\r\n        // If either failed do nothing.\r\n        if(timerStatus === 'complete' && distanceStatus === 'complete') {\r\n            this.startDragging(target, {\r\n                offsetX: offset.x,\r\n                offsetY: offset.y,\r\n                // Make relative to client.\r\n                startingX: currentPosition.x - window.pageXOffset,\r\n                startingY: currentPosition.y - window.pageYOffset\r\n            });\r\n        }\r\n    }\r\n\r\n    startDragging(element, pos) {\r\n        if(this.#isDragging) {\r\n            return;\r\n        }\r\n\r\n        this.#isDragging = true;\r\n\r\n        if(this.#revertFX) {\r\n            this.#revertFX.cancel();\r\n            this.#revertFX = null;\r\n        }\r\n\r\n        console.log(\"Start Dragging\");\r\n\r\n        let target = element,\r\n            container = this.container,\r\n            scroller = null,\r\n            dropTargets = [];\r\n\r\n        if(typeof container === 'string') {\r\n            container = document.querySelector(container);\r\n        }\r\n\r\n        if(this.helper) {\r\n            if(typeof this.helper === 'function') {\r\n                target = this.helper(element);\r\n            } else {\r\n                target = this.helper;\r\n            }\r\n        }\r\n\r\n        if(target !== element && !target.parentElement && element.parentElement) {\r\n            element.parentElement.appendChild(target);\r\n        }\r\n\r\n        let onMouseMove = event => {\r\n            event.preventDefault();\r\n            let rect = _moveElementToPosition(target, event.clientX, event.clientY, pos.offsetX, pos.offsetY, _selectElementRect(container, this, target, element));\r\n\r\n            if(this.scrollSpeed > 0) {\r\n                if(scroller) {\r\n                    scroller.cancel();\r\n                    scroller = null;\r\n                }\r\n\r\n                scroller = ScrollHelper.buildScrollHelper(element, target, rect, pos, this, event, this.scrollSpeed, container);\r\n            }\r\n\r\n            // drag-enter\r\n            let currentDropTargets = this.getDropTargets();\r\n\r\n            for(let dropTarget of currentDropTargets) {\r\n                if(dropTargets.indexOf(dropTarget) === -1) {\r\n                    _dispatchDropEvent(this, dropTarget, 'drag.enter', {bubbles: true, details: {clientX: event.clientX, clientY: event.clientY, target, element, originalEvent: event}});\r\n                }\r\n            }\r\n\r\n            // drag-move\r\n            for(let dropTarget of currentDropTargets) {\r\n                _dispatchDropEvent(this, dropTarget, 'drag.move', {bubbles: false, details: {clientX: event.clientX, clientY: event.clientY, target, element, originalEvent: event}});\r\n            }\r\n\r\n            for(let dropTarget of dropTargets) {\r\n                if(currentDropTargets.indexOf(dropTarget) === -1) {\r\n                    _dispatchDropEvent(this, dropTarget, 'drag.leave', {bubbles: false, details: {clientX: event.clientX, clientY: event.clientY, target, element, originalEvent: event}});\r\n                }\r\n            }\r\n\r\n            // drag-leave\r\n            dropTargets = currentDropTargets;\r\n        };\r\n\r\n        let onMouseUp = event => {\r\n            event.preventDefault();\r\n            document.removeEventListener('mousemove', onMouseMove);\r\n            document.removeEventListener('mouseup', onMouseUp);\r\n\r\n            if(scroller) {\r\n                scroller.cancel();\r\n                scroller = null;\r\n            }\r\n\r\n            dropTargets = this.getDropTargets();\r\n            let accepted = false;\r\n\r\n            for(let dropTarget of dropTargets) {\r\n                _dispatchDropEvent(this, dropTarget, 'drag.dropping', {\r\n                    bubbles: true,\r\n\r\n                    details: {\r\n                        clientX: event.clientX,\r\n                        clientY: event.clientY,\r\n                        originalEvent: event,\r\n                        target,\r\n                        element,\r\n                        accept() {\r\n                            accepted = true;\r\n                        }\r\n                    }\r\n                })\r\n            }\r\n\r\n            if(!accepted) {\r\n                if(this.revert) {\r\n                    _revert(element, target, this.revertDuration);\r\n                } else {\r\n                    if(target !== element) {\r\n                        target.parentElement.removeChild(target);\r\n                    }\r\n                }\r\n            } else {\r\n                if(target !== element) {\r\n                    target.parentElement.removeChild(target);\r\n                }\r\n\r\n                _moveElementToPosition(element, event.clientX, event.clientY, pos.offsetX, pos.offsetY, _selectElementRect(container, this, target, element));\r\n\r\n                for(let dropTarget of dropTargets) {\r\n                    _dispatchDropEvent(this, dropTarget, 'drag.drop', {\r\n                        bubbles: true,\r\n\r\n                        details: {\r\n                            clientX: event.clientX,\r\n                            clientY: event.clientY,\r\n                            originalEvent: event,\r\n                            target,\r\n                            element\r\n                        }\r\n                    })\r\n                }\r\n            }\r\n        };\r\n\r\n        // Set target to starting position.\r\n        if(pos.startingX !== undefined && pos.startingY !== undefined) {\r\n            let rect = _moveElementToPosition(target, pos.startingX, pos.startingY, pos.offsetX, pos.offsetY, _selectElementRect(container, this, target, element));\r\n            dropTargets = this.getDropTargets(rect, {mouseX: pos.startingX, mouseY: pos.startingY});\r\n\r\n            for(let dropTarget of dropTargets) {\r\n                _dispatchDropEvent(this, dropTarget, 'drag.enter', {bubbles: true, details: {initial: true, clientX: pos.startingX, clientY: pos.startingY, target, element}});\r\n            }\r\n        }\r\n\r\n        document.addEventListener('mousemove', onMouseMove);\r\n        document.addEventListener('mouseup', onMouseUp);\r\n        this.#isDragging = false;\r\n    }\r\n\r\n    getDropTargets() {\r\n        return [];\r\n    }\r\n\r\n    connect(droppable) {\r\n\r\n    }\r\n\r\n    disconnect(droppable) {\r\n\r\n    }\r\n\r\n    hasDroppable(droppable) {\r\n\r\n    }\r\n\r\n    get droppables() {\r\n        return this.#droppables.slice(0);\r\n    }\r\n\r\n    get element() {\r\n        return this.#element;\r\n    }\r\n}\r\n\r\n\r\nfunction _dispatchDropEvent(self, target, name, options) {\r\n\r\n}\r\n\r\n\r\nfunction _revert(element, target, revertDuration) {\r\n\r\n}\r\n\r\n\r\n/**\r\n * Takes a client (x, y) position and some offset coords and move the element to the given position.\r\n *\r\n * @param element\r\n * @param x\r\n * @param y\r\n * @param offsetX\r\n * @param offsetY\r\n * @param container\r\n * @private\r\n * @returns {*|Rect}\r\n */\r\nfunction _moveElementToPosition(element, x, y, offsetX, offsetY, container) {\r\n    let rect = new Rect(element);\r\n    rect = rect.moveTo({left: x, top: y});\r\n\r\n    offsetX = offsetX || 0;\r\n    offsetY = offsetY || 0;\r\n\r\n    rect = rect.translate(-offsetX, -offsetY);\r\n\r\n    if(container) {\r\n        container = new Rect(container);\r\n        rect = rect.fit(container);\r\n    }\r\n\r\n    setElementClientPosition(element, rect, 'translate3d');\r\n    return rect;\r\n}\r\n\r\n\r\n// noinspection JSCommentMatchesSignature\r\n/**\r\n * For module use only.  Selects the element either by css selector, if it's a string, or resolve a function.\r\n * If the element is already element is is returned direction.  Returns null if not element is provided.\r\n *\r\n * @param element\r\n * @param dragInstance\r\n * @param target\r\n * @returns {null|*}\r\n * @private\r\n */\r\nfunction _selectElementRect(element, dragInstance, target, originalTarget) {\r\n    if(element) {\r\n        let type = typeof element;\r\n\r\n        if(type === 'function') {\r\n            return new Rect(element.call(dragInstance, target, originalTarget, dragInstance));\r\n        } else if(type === 'string') {\r\n            return new Rect(document.querySelector(element));\r\n        }\r\n\r\n        return new Rect(element);\r\n    }\r\n\r\n    return null;\r\n}\r\n\r\n\r\n/**\r\n * Returns the first scrollable parent.\r\n *\r\n * @param element\r\n * @returns {HTMLElement|null}\r\n * @private\r\n */\r\nfunction _getScrollParent(element) {\r\n    let o = element.parentElement;\r\n\r\n    while(o) {\r\n        if (o.scrollWidth > o.clientWidth || o.scrollHeight > o.clientHeight) {\r\n            return o;\r\n        }\r\n\r\n        o = o.parentElement;\r\n    }\r\n\r\n    return null;\r\n}\r\n\r\n\r\n/**\r\n * Helper class that is used to control scrolling when the element is dragged outside of bounds.\r\n */\r\nclass ScrollHelper {\r\n    constructor(element, scrollXSpeed=0, scrollYSpeed=0, onFrame=null) {\r\n        this.frameID = null;\r\n        this.element = element;\r\n        this.scrollXSpeed = scrollXSpeed;\r\n        this.scrollYSpeed = scrollYSpeed;\r\n        this.onFrame = onFrame;\r\n        this.timestamp = performance.now();\r\n\r\n        let frame = timestamp => {\r\n            let delta = (timestamp - this.timestamp) / 1000;\r\n\r\n            // todo remove debug\r\n            // console.log({\r\n            //     delta,\r\n            //     scrollXSpeed: this.scrollXSpeed,\r\n            //     scrollYSpeed: this.scrollYSpeed,\r\n            //     timestamp,\r\n            //     lastTimestamp: this.timestamp\r\n            // });\r\n\r\n            this.timestamp = timestamp;\r\n\r\n            this.element.scrollLeft += delta * this.scrollXSpeed;\r\n            this.element.scrollTop += delta * this.scrollYSpeed;\r\n\r\n            if(this.onFrame) {\r\n                this.onFrame(this);\r\n            }\r\n\r\n            this.frameID = window.requestAnimationFrame(frame);\r\n        };\r\n\r\n        this.frameID = window.requestAnimationFrame(frame);\r\n    }\r\n\r\n    cancel() {\r\n        if(this.frameID) {\r\n            window.cancelAnimationFrame(this.frameID);\r\n            this.frameID = null;\r\n        }\r\n    }\r\n\r\n    static getScrollSpeed(rect, scrollParentRect) {\r\n        let r = {x: 0, y: 0};\r\n\r\n        if(rect.right > scrollParentRect.right) {\r\n            r.x = clamp((rect.right - scrollParentRect.right) / rect.width, -1, 1);\r\n        } else if(rect.left < scrollParentRect.left) {\r\n            r.x = clamp((rect.left - scrollParentRect.left) / rect.width, -1, 1);\r\n        }\r\n\r\n        if(rect.bottom > scrollParentRect.bottom) {\r\n            r.y = clamp((rect.bottom - scrollParentRect.bottom) / rect.width, -1, 1);\r\n        } else if(rect.top < scrollParentRect.top) {\r\n            r.y = clamp((rect.top - scrollParentRect.top) / rect.width, -1, 1);\r\n        }\r\n\r\n        return r;\r\n    }\r\n\r\n    static buildScrollHelper(element, target, rect, pos, dragInstance, event, scrollSpeed, container) {\r\n        let scrollParent = _getScrollParent(element);\r\n\r\n        if(scrollParent) {\r\n            let scrollParentRect = new Rect(scrollParent),\r\n                speed = ScrollHelper.getScrollSpeed(rect, scrollParentRect);\r\n\r\n            if(speed.x || speed.y) {\r\n                return new ScrollHelper(scrollParent, speed.x * scrollSpeed, speed.y * scrollSpeed, (scroller) => {\r\n                    let rect = _moveElementToPosition(target, event.clientX, event.clientY, pos.offsetX, pos.offsetY, _selectElementRect(container, dragInstance, target, element));\r\n\r\n                    let scrollRect = new Rect(scroller.element);\r\n\r\n                    setElementClientPosition(target, rect, 'translate3d');\r\n\r\n                    if(scrollRect.contains(rect)) {\r\n                        scroller.cancel();\r\n                        scroller = null;\r\n                    }\r\n                });\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\n\r\nexport function ScrollArea(selector) {\r\n    return function() {\r\n        let element = selector;\r\n\r\n        if(typeof element === 'string') {\r\n            element = document.querySelector(element);\r\n        }\r\n\r\n        let rect = new Rect(element),\r\n            scroll = getScroll(element);\r\n\r\n        rect.left -= scroll.scrollLeft;\r\n        rect.top -= scroll.scrollTop;\r\n        rect.right = rect.left + element.scrollWidth;\r\n        rect.bottom = rect.top + element.scrollHeight;\r\n\r\n        return rect;\r\n    }\r\n}\r\n\r\n\r\nexport function clone(opacity=null, className=null, zIndex=null) {\r\n    if(typeof opacity === 'object' && opacity.nodeType) {\r\n        return opacity.cloneNode(true);\r\n    }\r\n\r\n    return function(element) {\r\n        let r = element.cloneNode(true);\r\n\r\n        if(opacity !== null) {\r\n            r.style.opacity = opacity;\r\n        }\r\n\r\n        if(className) {\r\n            r.className = className;\r\n        }\r\n\r\n        r.style.position = \"absolute\";\r\n        if(zIndex !== null) r.style.zIndex = zIndex;\r\n\r\n        return r;\r\n    }\r\n}\r\n"],"sourceRoot":""}