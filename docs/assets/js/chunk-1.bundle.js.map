{"version":3,"sources":["webpack://pendora/./src/core/ui/Draggable.js"],"names":["reg_percentage_test","cursor","target","event","rect","Rect","x","clientX","left","y","clientY","top","buildTestIntersectionFunction","amount","element","targetRect","intersection","p","getArea","Draggable","container","axis","exclude","delay","offset","resistance","handle","helper","revert","revertDuration","scrollSpeed","selector","tolerance","setHelperSize","grid","document","querySelector","WeakMap","onMouseDown","addEventListener","startPosition","window","pageXOffset","pageYOffset","currentPosition","cancelMouseTracking","cancelTimer","closest","contains","Array","isArray","preventDefault","distanceBrokenPromise","Promise","resolve","isDistanceBroken","onMouseMove","calcDistance","removeEventListener","timerPromise","timer","setTimeout","clearTimeout","onMouseUp","all","timerStatus","distanceStatus","startDragging","offsetX","offsetY","startingX","startingY","pos","cache","get","mousePosition","isDragging","fx","set","cancel","scroller","dropTargets","startingClientRect","translate","style","width","height","pointerEvents","parentElement","appendChild","classList","add","refreshDropTargets","mouseX","mouseY","currentDropTargets","detail","getDropTargets","dropTarget","indexOf","dispatchDropEvent","_moveElementToPosition","_selectElementRect","ScrollHelper","buildScrollHelper","publishDragMoveEvent","remove","accepted","isDefaultPrevented","reverted","publishDragDropEvent","isAccepted","accept","removeChild","setElementClientPosition","_revert","undefined","mousePos","r","testFunction","type","test","parseFloat","droppable","push","droppables","querySelectorAll","length","i","item","splice","slice","Publisher","position","onFrame","starting","animation","Animation","frames","applyFrame","frame","animate","duration","self","startingRect","moveTo","right","bottom","Math","floor","fit","dragInstance","originalTarget","call","_getScrollParent","o","scrollWidth","clientWidth","scrollHeight","clientHeight","_getScrollRect","nodeName","innerWidth","innerHeight","scrollXSpeed","scrollYSpeed","frameID","timestamp","performance","now","delta","scrollLeft","scrollTop","requestAnimationFrame","cancelAnimationFrame","scrollParentRect","clamp","scrollParent","speed","getScrollSpeed","scrollRect","ScrollArea","scroll","getScroll","clone","opacity","className","zIndex","nodeType","cloneNode","bubbles","options","name","originalEvent","currentRect","dispatch","publish","eventPackage","draggable","Object","assign","customEvent","CustomEvent","dispatchEvent"],"mappings":"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","file":"chunk-1.bundle.js","sourcesContent":["import Publisher from \"../Publisher\";\nimport {calcDistance, clamp} from \"../utility\";\nimport Rect from \"../vectors/Rect\";\nimport {getScroll} from \"../utility\";\nimport {setElementClientPosition} from \"./position\";\nimport Animation from \"../fx/Animation\";\n\n\nconst reg_percentage_test = /\\s*\\d+\\.?\\d*%\\s*/;\n\n\n/**\n * Returns the offset position of the mouse relative to the target.\n *\n * @param target\n * @param event\n * @returns {{x: number, y: number}}\n */\nexport function cursor(target, event) {\n    let rect = new Rect(target);\n\n    return {\n        x: event.clientX - rect.left,\n        y: event.clientY - rect.top\n    };\n}\n\n\nfunction buildTestIntersectionFunction(amount) {\n    return function(element, rect) {\n        rect = new Rect(rect);\n\n        let targetRect = new Rect(element),\n            intersection = targetRect.intersection(rect),\n            p = intersection ? intersection.getArea() / rect.getArea() : 0;\n\n        if(amount === 0) {\n            return p > 0;\n        } else {\n            return p >= amount;\n        }\n    }\n}\n\n\nexport default class Draggable extends Publisher {\n    #element;\n    #droppables;\n    #boundOnMouseDown;\n    #itemCache;\n\n    constructor(element, {container=null, axis='xy', exclude='input, button, .ui-resizeable-handle, .no-drag', delay=0, offset=cursor,\n        resistance=0, handle=null, helper=null, revert=false, revertDuration=0,\n        scrollSpeed=0, selector=null, tolerance=0.5, setHelperSize=false, grid=null}={}) {\n        super();\n\n        if(typeof element === 'string') {\n            this.#element = document.querySelector(element);\n        } else {\n            this.#element = element;\n        }\n\n        this.#droppables = [];\n        this.#itemCache = new WeakMap();\n\n        this.container = container;\n        this.axis = axis;\n        this.exclude = exclude;\n        this.delay = delay;\n        this.offset = offset;\n        this.resistance = resistance;\n        this.handle = handle;\n        this.helper = helper;\n        this.revert = revert;\n        this.revertDuration = revertDuration;\n        this.scrollSpeed = scrollSpeed;\n        this.selector = selector;\n        this.tolerance = tolerance;\n        this.setHelperSize = setHelperSize;\n        this.grid = grid;\n\n        if(typeof this.container === 'string') {\n            this.container = document.querySelector(this.container);\n        }\n\n        this.#boundOnMouseDown = event => {\n            return this.onMouseDown(event);\n        };\n\n        this.element.addEventListener('mousedown', this.#boundOnMouseDown);\n    }\n\n    /**\n     * Starts dragging if the correct elements have been targeted and delay and resistance have been meet.\n     *\n     * @param event\n     * @returns {Promise<void>}\n     */\n    async onMouseDown(event) {\n        let startPosition = {x: event.clientX + window.pageXOffset, y: event.clientY + window.pageYOffset},\n            currentPosition = {x: startPosition.x, y: startPosition.y},\n            target = this.#element,\n            cancelMouseTracking = null,\n            cancelTimer = null,\n            distanceBrokenPromise,\n            timerPromise,\n            offset;\n\n        // Only start dragging if a draggable child of the element is targeted.\n        // If selector is null then the entire element is draggable and should be the target.\n        if(this.selector) {\n            target = event.target.closest(this.selector);\n\n            if(!target || !this.#element.contains(target)) {\n                return;\n            }\n        }\n\n        // Only start dragging if the handle was targeted.\n        // If handle is null then the entire target is the handle.\n        if(this.handle) {\n            let handle = event.target.closest(this.handle);\n\n            if(!handle || !target.contains(handle)) {\n                return;\n            }\n        }\n\n        // If any excluded elements are targeted ignore the event.\n        if(this.exclude) {\n            let exclude = event.target.closest(this.exclude);\n\n            if(exclude && target.contains(exclude)) {\n                return;\n            }\n        }\n\n        // Find the offset of the event.\n        if(typeof this.offset === 'function') {\n            offset = this.offset(target, event);\n        } else if(Array.isArray(this.offset)) {\n            offset = {\n                x: this.offset[0],\n                y: this.offset[1]\n            };\n        } else if(typeof this.offset === 'object') {\n            offset = {\n                x: this.offset.x,\n                y: this.offset.y\n            };\n        } else {\n            offset = {x: 0, y: 0};\n        }\n\n        // Prevent default browser actions.\n        event.preventDefault();\n\n        // At this point we can be sure that a draggable item was\n        // targeted by it's handle and no excluded items where clicked.\n\n        // Creates a promise that both tracks the current mouse coords and resolve\n        // when the user passes the given resistance.\n        distanceBrokenPromise = new Promise(resolve => {\n            let isDistanceBroken = this.resistance <= 0;\n\n            if(isDistanceBroken) {\n                resolve('complete');\n            }\n\n            let onMouseMove = event => {\n                currentPosition.x = event.clientX + window.pageXOffset;\n                currentPosition.y = event.clientY + window.pageYOffset;\n                event.preventDefault();\n\n                if(!isDistanceBroken && calcDistance(currentPosition.x, currentPosition.y, startPosition.x, startPosition.y) > this.resistance) {\n                    resolve('complete');\n                    isDistanceBroken = true;\n                }\n            };\n\n            // Cancel mouse tracking and resolve the promise to canceled if hasn't already been resolve.\n            // This function must be called or their will be a memory leak before onMouseDown completes.\n            cancelMouseTracking = () => {\n                if(onMouseMove) {\n                    document.removeEventListener('mousemove', onMouseMove);\n\n                    if(!isDistanceBroken) {\n                        resolve('canceled');\n                    }\n\n                    onMouseMove = null;\n                }\n            };\n\n            document.addEventListener('mousemove', onMouseMove);\n        });\n\n        // Creates a promise that resolve when after the delay time passes or the user cancels the drag by\n        // releasing the mouse button.\n        timerPromise = new Promise(resolve => {\n            let timer = null;\n\n            if(this.delay >= 0) {\n                timer = setTimeout(() => {\n                    resolve(\"complete\");\n                    timer = null;\n                }, this.delay);\n            } else {\n                resolve('complete');\n            }\n\n            // cancel the timer and resolve it to canceled if it is still active.\n            cancelTimer = () => {\n                if(timer) {\n                    clearTimeout(timer);\n                    resolve('canceled');\n                }\n            };\n        });\n\n        // cancel the timer and mouse tracking if they are still active.\n        let onMouseUp = event => {\n            event.preventDefault();\n            cancelTimer();\n            cancelMouseTracking();\n            document.removeEventListener('mouseup', onMouseUp);\n        };\n\n        document.addEventListener('mouseup', onMouseUp);\n\n        // Wait until the delay time and distance have passed or failed.\n        let [timerStatus, distanceStatus] = await Promise.all([timerPromise, distanceBrokenPromise]);\n\n        // Ensure that mouse tracking has been canceled.\n        if(cancelMouseTracking) cancelMouseTracking();\n\n        // At this point both the timer and distance status should have passed or failed.\n        // If either failed do nothing.\n        if(timerStatus === 'complete' && distanceStatus === 'complete') {\n            this.startDragging(target, {\n                offsetX: offset.x,\n                offsetY: offset.y,\n                // Make relative to client.\n                startingX: currentPosition.x,\n                startingY: currentPosition.y\n            });\n        }\n    }\n\n    async startDragging(element, pos) {\n        let cache = this.#itemCache.get(element),\n            mousePosition = {x: pos.startingX, y: pos.startingY};\n\n        if(!cache) {\n            cache = {isDragging: false, fx: null, rect: null, helper: null, element: element};\n            this.#itemCache.set(element, cache);\n        }\n\n        if(cache.isDragging) {\n            return;\n        }\n\n        cache.isDragging = true;\n\n        if(cache.fx) {\n            await cache.fx.cancel();\n            cache.fx = null;\n        }\n\n        let target = element,\n            container = this.container,\n            scroller = null,\n            dropTargets = [],\n            startPosition = new Rect(element),\n            startingClientRect = startPosition;\n\n        startPosition = startPosition.translate(\n            window.pageXOffset,\n            window.pageYOffset\n        );\n\n        if(!cache.rect) {\n            cache.rect = startPosition;\n        }\n\n        if(typeof container === 'string') {\n            container = document.querySelector(container);\n        }\n\n        if(this.helper) {\n            if(typeof this.helper === 'function') {\n                target = this.helper(element);\n            } else {\n                target = this.helper;\n            }\n\n            if(this.setHelperSize) {\n                target.style.width = startPosition.width + \"px\";\n                target.style.height = startPosition.height + \"px\";\n            }\n\n            target.style.pointerEvents = 'none';\n\n            if(!target.parentElement && element.parentElement) {\n                element.parentElement.appendChild(target);\n            }\n\n            target.classList.add('ui-drag-helper');\n\n            cache.helper = target;\n        }\n\n        let refreshDropTargets = (rect) => {\n            // drag-enter\n            let mouseX = mousePosition.x - window.pageXOffset,\n                mouseY = mousePosition.y - window.pageYOffset,\n                currentDropTargets,\n                detail = {clientX: mouseX, clientY: mouseY};\n\n            if(rect !== null) {\n                currentDropTargets = this.getDropTargets(rect, {mouseX, mouseY});\n            } else {\n                currentDropTargets = [];\n            }\n\n            for(let dropTarget of currentDropTargets) {\n                if(dropTargets.indexOf(dropTarget) === -1) {\n                    dispatchDropEvent(this, 'drag.enter', element, target, null, rect, true, true, false, detail, dropTarget);\n                }\n            }\n\n            for(let dropTarget of dropTargets) {\n                if(currentDropTargets.indexOf(dropTarget) === -1) {\n                    dispatchDropEvent(this, 'drag.leave', element, target, null, rect, true, true, false, detail, dropTarget);\n                }\n            }\n\n            // drag-leave\n            dropTargets = currentDropTargets;\n        };\n\n        let onMouseMove = event => {\n            event.preventDefault();\n            let rect = _moveElementToPosition(this, target, event.clientX, event.clientY, pos.offsetX, pos.offsetY, _selectElementRect(container, this, target, element));\n\n            mousePosition.x = event.clientX + window.pageXOffset;\n            mousePosition.y = event.clientY + window.pageYOffset;\n\n            if(this.scrollSpeed > 0) {\n                if(scroller) {\n                    scroller.cancel();\n                    scroller = null;\n                }\n\n                scroller = ScrollHelper.buildScrollHelper(element, target, rect, pos, this, event, this.scrollSpeed, container);\n            }\n\n            refreshDropTargets(rect);\n\n            publishDragMoveEvent(this, element, target, event, rect);\n        };\n\n        let onMouseUp = async event => {\n            event.preventDefault();\n            document.removeEventListener('mousemove', onMouseMove);\n            document.removeEventListener('mouseup', onMouseUp);\n            cache.isDragging = false;\n            element.classList.remove('ui-dragging');\n\n            if(scroller) {\n                scroller.cancel();\n                scroller = null;\n            }\n\n            let accepted = false,\n                isDefaultPrevented = false,\n                reverted = false,\n                rect = new Rect(target);\n\n            publishDragDropEvent(this, element, target, event, rect, false, {\n                isDefaultPrevented() {\n                    return isDefaultPrevented;\n                },\n\n                isAccepted() {\n                    return accepted;\n                },\n\n                accept() {\n                    accepted = true;\n                },\n\n                preventDefault() {\n                    isDefaultPrevented = true;\n                }\n            });\n\n            if(this.revert && !accepted) {\n                refreshDropTargets(cache.rect);\n                rect = cache.rect;\n\n                if(!this.revertDuration) {\n                    if(target !== element) {\n                        target.parentElement.removeChild(target);\n                    } else {\n                        let pos = startPosition.translate(\n                            -window.pageXOffset,\n                            -window.pageYOffset\n                        );\n\n                        setElementClientPosition(target, pos, 'translate3d');\n                    }\n                } else {\n                    cache.fx = _revert(target, cache.rect, this.revertDuration);\n\n                    await cache.fx;\n\n                    if(target !== element) {\n                        target.parentElement.removeChild(target);\n                    }\n                }\n\n                reverted = true;\n            } else {\n                if(target !== element) {\n                    target.parentElement.removeChild(target);\n                    setElementClientPosition(element, rect, 'translate3d');\n                }\n            }\n\n            this.#itemCache.delete(element);\n\n            dispatchDropEvent(this, 'drag.end', element, target, event, rect, true, true, true, {accepted, reverted}, element);\n        };\n\n        // Set target to starting position.\n        if(mousePosition.x !== undefined && mousePosition.y !== undefined) {\n            let rect = _moveElementToPosition(this, target, mousePosition.x - window.pageXOffset, mousePosition.y - window.pageYOffset, pos.offsetX, pos.offsetY, _selectElementRect(container, this, target, element));\n            refreshDropTargets(rect);\n        }\n\n        document.addEventListener('mousemove', onMouseMove);\n        document.addEventListener('mouseup', onMouseUp);\n        element.classList.add('ui-dragging');\n\n        dispatchDropEvent(this, 'drag.start', element, target, null, startingClientRect, true, true, true, null);\n    }\n\n    getDropTargets(rect, mousePos) {\n        let r = [];\n\n        /**\n         * @type {number|String|Function|string}\n         */\n        let testFunction = this.tolerance,\n            type = typeof testFunction;\n\n        if(type === 'string') {\n            // noinspection JSCheckFunctionSignatures\n            if(reg_percentage_test.test(testFunction)) {\n                // noinspection JSCheckFunctionSignatures\n                testFunction = buildTestIntersectionFunction(parseFloat(testFunction) / 100);\n            }\n        } else if(type === 'number') {\n            testFunction = buildTestIntersectionFunction(testFunction);\n        }\n\n        for(let droppable of this.#droppables) {\n            if(testFunction(droppable, rect, mousePos, this)) {\n                r.push(droppable);\n            }\n        }\n\n        return r;\n    }\n\n    connect(droppables) {\n        if(typeof droppables === 'string') {\n            droppables = document.querySelectorAll(droppables);\n        } else if(typeof droppables.length !== 'number') {\n            droppables = [droppables];\n        }\n\n        for(let i = 0; i < droppables.length; i++) {\n            let item = droppables[i];\n\n            if(this.#droppables.indexOf(item) === -1) {\n                this.#droppables.push(item);\n            }\n        }\n    }\n\n    // noinspection JSUnusedGlobalSymbols\n    disconnect(droppable) {\n        if(typeof droppable === 'string') {\n            droppable = document.querySelector(droppable);\n        }\n\n        let i = this.#droppables.indexOf(droppable);\n\n        if(i !== -1) {\n            this.#droppables.splice(i, 1);\n        }\n    }\n\n    // noinspection JSUnusedGlobalSymbols\n    hasDroppable(droppable) {\n        if(typeof droppable === 'string') {\n            droppable = document.querySelector(droppable);\n        }\n\n        return this.#droppables.indexOf(droppable) !== -1;\n    }\n\n    // noinspection JSUnusedGlobalSymbols\n    get droppables() {\n        return this.#droppables.slice(0);\n    }\n\n    get element() {\n        return this.#element;\n    }\n}\n\n\nfunction _revert(target, position, revertDuration, onFrame=null) {\n    let starting = new Rect(target);\n\n    let animation = new Animation({\n        frames: {\n            '0%': {\n                left: starting.left + window.pageXOffset,\n                top: starting.top + window.pageYOffset\n            },\n\n            '100%': {\n                left: position.left,\n                top: position.top\n            }\n        },\n\n        applyFrame(fx, frame) {\n            setElementClientPosition(fx.element, {\n                left: frame.left - window.pageXOffset,\n                top: frame.top - window.pageYOffset\n            }, 'translate3d');\n\n            if(onFrame) onFrame(fx);\n        }\n    });\n\n    return animation.animate(target, {duration: revertDuration});\n}\n\n\n/**\n * Takes a client (x, y) position and some offset coords and move the element to the given position.\n *\n * @param self\n * @param element\n * @param x\n * @param y\n * @param offsetX\n * @param offsetY\n * @param container\n * @private\n * @returns {*|Rect}\n */\nfunction _moveElementToPosition(self, element, x, y, offsetX, offsetY, container) {\n    let rect = new Rect(element),\n        startingRect = rect;\n\n    rect = rect.moveTo({left: x, top: y});\n\n    offsetX = offsetX || 0;\n    offsetY = offsetY || 0;\n\n    rect = rect.translate(-offsetX, -offsetY);\n\n    if(self.axis === 'y') {\n        rect = new Rect(\n            startingRect.left,\n            rect.top,\n            startingRect.right,\n            rect.bottom\n        );\n    } else if(self.axis === 'x') {\n        rect = new Rect(\n            rect.left,\n            startingRect.top,\n            rect.right,\n            startingRect.bottom\n        );\n    }\n\n    if(typeof self.grid === 'number' && self.grid) {\n        let left = Math.floor(rect.left / self.grid) * self.grid,\n            top = Math.floor(rect.top / self.grid) * self.grid;\n\n        rect = new Rect(left, top, left + startingRect.width, top + startingRect.height);\n    }\n\n    if(container) {\n        container = new Rect(container);\n        rect = rect.fit(container);\n    }\n\n    setElementClientPosition(element, rect, 'translate3d');\n    return rect;\n}\n\n\n// noinspection JSCommentMatchesSignature\n/**\n * For module use only.  Selects the element either by css selector, if it's a string, or resolve a function.\n * If the element is already element is is returned direction.  Returns null if not element is provided.\n *\n * @param element\n * @param dragInstance\n * @param target\n * @returns {null|*}\n * @private\n */\nfunction _selectElementRect(element, dragInstance, target, originalTarget) {\n    if(element) {\n        let type = typeof element;\n\n        if(type === 'function') {\n            return new Rect(element.call(dragInstance, target, originalTarget, dragInstance));\n        } else if(type === 'string') {\n            return new Rect(document.querySelector(element));\n        }\n\n        return new Rect(element);\n    }\n\n    return null;\n}\n\n\n/**\n * Returns the first scrollable parent.\n *\n * @param element\n * @returns {HTMLElement|null}\n * @private\n */\nfunction _getScrollParent(element) {\n    let o = element.parentElement;\n\n    while(o) {\n        if (o.scrollWidth > o.clientWidth || o.scrollHeight > o.clientHeight) {\n            return o;\n        }\n\n        o = o.parentElement;\n    }\n\n    return null;\n}\n\n\nfunction _getScrollRect(element) {\n    if(element === window || element.nodeName === \"HTML\") {\n        return new Rect(0, 0, window.innerWidth, window.innerHeight);\n    } else {\n        return new Rect(element);\n    }\n}\n\n\n/**\n * Helper class that is used to control scrolling when the element is dragged outside of bounds.\n */\nclass ScrollHelper {\n    constructor(element, scrollXSpeed=0, scrollYSpeed=0, onFrame=null) {\n        this.frameID = null;\n        this.element = element;\n        this.scrollXSpeed = scrollXSpeed;\n        this.scrollYSpeed = scrollYSpeed;\n        this.onFrame = onFrame;\n        this.timestamp = performance.now();\n\n        let frame = timestamp => {\n            let delta = (timestamp - this.timestamp) / 1000;\n\n            this.timestamp = timestamp;\n\n            this.element.scrollLeft += delta * this.scrollXSpeed;\n            this.element.scrollTop += delta * this.scrollYSpeed;\n\n            if(this.onFrame) {\n                this.onFrame(this);\n            }\n\n            this.frameID = window.requestAnimationFrame(frame);\n        };\n\n        this.frameID = window.requestAnimationFrame(frame);\n    }\n\n    cancel() {\n        if(this.frameID) {\n            window.cancelAnimationFrame(this.frameID);\n            this.frameID = null;\n        }\n    }\n\n    static getScrollSpeed(rect, scrollParentRect) {\n        let r = {x: 0, y: 0};\n\n        if(rect.right > scrollParentRect.right) {\n            r.x = clamp((rect.right - scrollParentRect.right) / rect.width, -1, 1);\n        } else if(rect.left < scrollParentRect.left) {\n            r.x = clamp((rect.left - scrollParentRect.left) / rect.width, -1, 1);\n        }\n\n        if(rect.bottom > scrollParentRect.bottom) {\n            r.y = clamp((rect.bottom - scrollParentRect.bottom) / rect.width, -1, 1);\n        } else if(rect.top < scrollParentRect.top) {\n            r.y = clamp((rect.top - scrollParentRect.top) / rect.width, -1, 1);\n        }\n\n        return r;\n    }\n\n    static buildScrollHelper(element, target, rect, pos, dragInstance, event, scrollSpeed, container) {\n        let scrollParent = _getScrollParent(element);\n\n        if(scrollParent) {\n            let scrollParentRect = _getScrollRect(scrollParent),\n                speed = ScrollHelper.getScrollSpeed(rect, scrollParentRect);\n\n            if(speed.x || speed.y) {\n                return new ScrollHelper(scrollParent, speed.x * scrollSpeed, speed.y * scrollSpeed, (scroller) => {\n                    let rect = _moveElementToPosition(this, target, event.clientX, event.clientY, pos.offsetX, pos.offsetY, _selectElementRect(container, dragInstance, target, element));\n\n                    let scrollRect = new Rect(scroller.element);\n\n                    setElementClientPosition(target, rect, 'translate3d');\n\n                    if(scrollRect.contains(rect)) {\n                        scroller.cancel();\n                        scroller = null;\n                    }\n                });\n            }\n        }\n    }\n}\n\n\nexport function ScrollArea(selector) {\n    return function() {\n        let element = selector;\n\n        if(typeof element === 'string') {\n            element = document.querySelector(element);\n        }\n\n        let rect = new Rect(element),\n            scroll = getScroll(element);\n\n        rect.left -= scroll.scrollLeft;\n        rect.top -= scroll.scrollTop;\n        rect.right = rect.left + element.scrollWidth;\n        rect.bottom = rect.top + element.scrollHeight;\n\n        return rect;\n    }\n}\n\n\nexport function clone(opacity=null, className=null, zIndex=null) {\n    if(typeof opacity === 'object' && opacity.nodeType) {\n        return opacity.cloneNode(true);\n    }\n\n    return function(element) {\n        let r = element.cloneNode(true);\n\n        if(opacity !== null) {\n            r.style.opacity = opacity;\n        }\n\n        if(className) {\n            r.className = className;\n        }\n\n        r.style.position = \"absolute\";\n        if(zIndex !== null) r.style.zIndex = zIndex;\n\n        return r;\n    }\n}\n\n\nfunction publishDragMoveEvent(self, element, helper, event, rect, bubbles=false, options=null) {\n    return dispatchDropEvent(self, 'drag.move', element, helper, event, rect, bubbles, true, true, options);\n}\n\n\nfunction publishDragDropEvent(self, element, helper, event, rect, bubbles=true, options=null) {\n    return dispatchDropEvent(self, 'drag.drop', element, helper, event, rect, bubbles, true, true, options);\n}\n\n\nfunction dispatchDropEvent(self, name, element, helper, originalEvent, currentRect, bubbles=false, dispatch=true, publish=false, detail=null, target=null) {\n    let eventPackage = {\n        name,\n        draggable: self,\n        target: helper,\n        element,\n        item: element, // alias for element\n        helper: helper,\n        originalEvent: null,\n        rect: currentRect\n    };\n\n    if(originalEvent) {\n        eventPackage.originalEvent = originalEvent;\n        eventPackage.clientX = originalEvent.clientX;\n        eventPackage.clientY = originalEvent.clientY;\n    }\n\n    if(!target) {\n        target = element;\n    }\n\n    if(detail) {\n        Object.assign(eventPackage, detail);\n    }\n\n    if(publish) {\n        self.publish(name, eventPackage);\n    }\n\n    if(dispatch) {\n        let customEvent = new CustomEvent(name, {\n            bubbles,\n            detail: eventPackage\n        });\n\n        target.dispatchEvent(customEvent);\n    }\n}\n"],"sourceRoot":""}