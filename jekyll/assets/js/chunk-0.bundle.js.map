{"version":3,"sources":["webpack://pendora/./src/core/fx/Animation.js","webpack://pendora/./src/core/fx/FX.js","webpack://pendora/./src/core/fx/easing.js","webpack://pendora/./src/core/fx/frame.js","webpack://pendora/./src/core/fx/types.js","webpack://pendora/./src/core/ui/Draggable2.js"],"names":["Animation","duration","frames","applyFrame","defaultApplyFrame","bubbleFrameEvent","finishFrame","element","easing","onStart","onFrame","onPause","onCancel","onEnd","onComplete","FX","animation","fx","EASING","linear","position","autoPlay","init","call","destroy","play","animate","complete","config","defaults","_options","Object","assign","canceled","paused","pending","error","playing","regNumberWithUnit","regColor","regFunction","TYPE_FUNCTIONS","hex","RGBA","parseHexColorStringArg","rgb","parseRGBAColorStringArgs","rgba","DeadFXError","ExtendableError","assertFXAlive","status","doPromiseAction","onAction","value","resolveOrReject","_prepareValue","trim","m","exec","NumberWithUnit","parseFloat","_getFrames","r","keyframeIndex","hasOwnProperty","frame","property","Symbol","toStringTag","selectElement","undefined","key","pos","freeze","push","properties","sort","a","b","startPosition","startValue","endPosition","endValue","getFrameFX","options","p","delta","subtract","add","scalar","tick","performance","now","frameFN","timestamp","dispatchEvent","CustomEvent","bubbles","detail","window","requestAnimationFrame","_complete","cancelAnimationFrame","_triggerEndEvent","completeAnimation","_cancel","getFrame","onResolve","state","onReject","Promise","resolve","reject","onFinally","then","slice","style","toString","unit","TypeError","Error","reg_percentage_test","cursor","target","event","rect","Rect","x","clientX","left","y","clientY","top","buildTestIntersectionFunction","amount","targetRect","intersection","getArea","Draggable2","container","axis","exclude","delay","offset","resistance","handle","helper","revert","revertDuration","scrollSpeed","selector","tolerance","setHelperSize","grid","document","querySelector","WeakMap","onMouseDown","addEventListener","pageXOffset","pageYOffset","currentPosition","cancelMouseTracking","cancelTimer","closest","contains","Array","isArray","preventDefault","distanceBrokenPromise","isDistanceBroken","onMouseMove","calcDistance","removeEventListener","timerPromise","timer","setTimeout","clearTimeout","onMouseUp","all","timerStatus","distanceStatus","startDragging","offsetX","offsetY","startingX","startingY","cache","get","mousePosition","isDragging","set","cancel","scroller","dropTargets","startingClientRect","translate","width","height","pointerEvents","parentElement","appendChild","classList","refreshDropTargets","mouseX","mouseY","currentDropTargets","getDropTargets","dropTarget","indexOf","dispatchDropEvent","_moveElementToPosition","_selectElementRect","ScrollHelper","buildScrollHelper","publishDragMoveEvent","remove","accepted","isDefaultPrevented","reverted","publishDragDropEvent","isAccepted","accept","removeChild","setElementClientPosition","_revert","mousePos","testFunction","type","test","droppable","droppables","querySelectorAll","length","i","item","splice","Publisher","starting","self","startingRect","moveTo","right","bottom","Math","floor","fit","dragInstance","originalTarget","_getScrollParent","o","scrollWidth","clientWidth","scrollHeight","clientHeight","_getScrollRect","nodeName","innerWidth","innerHeight","scrollXSpeed","scrollYSpeed","frameID","scrollLeft","scrollTop","scrollParentRect","clamp","scrollParent","speed","getScrollSpeed","scrollRect","ScrollArea","scroll","getScroll","clone","opacity","className","zIndex","nodeType","cloneNode","name","originalEvent","currentRect","dispatch","publish","eventPackage","draggable","customEvent"],"mappings":"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","file":"chunk-0.bundle.js","sourcesContent":["import {EASING} from \"./easing\";\r\nimport FX from \"./FX\";\r\nimport {defaultApplyFrame} from \"./frame\";\r\n\r\n\r\nexport default class Animation {\r\n    static defaultApplyFrame = defaultApplyFrame;\r\n\r\n    static complete = FX.complete;\r\n    static canceled = FX.canceled;\r\n    static paused = FX.paused;\r\n    static pending = FX.pending;\r\n    static error = FX.error;\r\n    static playing = FX.playing;\r\n\r\n    /**\r\n     *\r\n     * @param duration\r\n     * @param frames {{}|function(Element element, Animation animation):{}}\r\n     * @param applyFrame - The function that takes a frame and applies it to the element.\r\n     * @param bubbleFrameEvent\r\n     * @param finishFrame\r\n     */\r\n    constructor({duration=null, frames, applyFrame = defaultApplyFrame, bubbleFrameEvent = false, finishFrame = null}) {\r\n        this.frames = frames;\r\n        this.applyFrame = applyFrame || Animation.defaultApplyFrame;\r\n        this.bubbleFrameEvent = bubbleFrameEvent;\r\n        this.finishFrame = finishFrame;\r\n        this.duration = duration;\r\n    }\r\n\r\n    /**\r\n     * Creates an fx object.\r\n     *\r\n     * @param element\r\n     * @param frames\r\n     * @param duration\r\n     * @param applyFrame\r\n     * @param easing\r\n     * @param onStart\r\n     * @param onFrame\r\n     * @param onPause\r\n     * @param onCancel\r\n     * @param onEnd\r\n     * @param onComplete\r\n     * @param bubbleFrameEvent\r\n     * @param finishFrame\r\n     * @returns {FX}\r\n     */\r\n    init({element, frames, duration, applyFrame, easing, onStart, onFrame, onPause, onCancel, onEnd, onComplete, bubbleFrameEvent, finishFrame}) {\r\n        return new FX(element, frames, duration, {\r\n            applyFrame,\r\n            easing,\r\n            animation: this,\r\n            onStart,\r\n            onFrame,\r\n            onPause,\r\n            onCancel,\r\n            onEnd,\r\n            onComplete,\r\n            bubbleFrameEvent,\r\n            finishFrame,\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Ran after the fx completes.\r\n     * @param fx\r\n     */\r\n    destroy(fx) {\r\n\r\n    }\r\n\r\n    /**\r\n     * Animates the given element.  Returns the FX object that can be used to control the animation.\r\n     *\r\n     * @param element {HTMLElement|Element} The element to animate.\r\n     * @param duration {Number} The duration of the animation in milliseconds.\r\n     * @param easing {function(Number)} An easing function that controls the rate of change for the animation.  If null linear animation is used.\r\n     * @param onStart {function(FX)} A callback function that is called right before the animation starts playing.\r\n     * @param onFrame {function(FX, frame)} A callback that is called per frame.\r\n     * @param onPause {function(FX)} A callback that is called when the FX pauses.\r\n     * @param onCancel {function(FX)} A callback that is called when the FX cancels.\r\n     * @param onEnd {function(FX)} A callback that is called when the animation ends.  Whether by completing, pausing, or canceling.  See Fx.status to determine what happened.\r\n     * @param onComplete {function(FX)} A callback that is called when the animation complete successfully.\r\n     * @param position\r\n     * @param autoPlay\r\n     * @returns {FX}\r\n     */\r\n    animate(element, {duration=null, easing = EASING.linear, onStart = null, onFrame = null, onPause = null, onCancel = null, onEnd = null, onComplete = null, position=0, autoPlay=true} = {}) {\r\n        if(duration === null) {\r\n            duration = this.duration;\r\n        }\r\n\r\n        let fx = this.init({\r\n            element: element,\r\n            frames: this.frames,\r\n            duration,\r\n            applyFrame: this.applyFrame,\r\n            easing,\r\n            animation: this,\r\n            onStart,\r\n            onFrame,\r\n            onPause,\r\n            onCancel,\r\n            onEnd: (fx) => {\r\n                if(onEnd) onEnd.call(fx, fx);\r\n                this.destroy(fx);\r\n            },\r\n            onComplete,\r\n            bubbleFrameEvent: this.bubbleFrameEvent,\r\n            finishFrame: this.finishFrame\r\n        });\r\n\r\n        if(position) {\r\n            fx.goto(position);\r\n        }\r\n\r\n        if(autoPlay) {\r\n            fx.play();\r\n        }\r\n        return fx;\r\n    }\r\n\r\n    goto(element, position) {\r\n        this.animate(element, {autoPlay: false, position: position});\r\n        return Animation.complete;\r\n    }\r\n\r\n    /**\r\n     * Creates a function that calls the animate method with the bound parameters.\r\n     * Parameters can be overridden in the created function when called.\r\n     * Method has the same signature as the animate method.\r\n     *\r\n     * Usage:\r\n     * let animation = new Animation(...),\r\n     *     fx = animation.bind(null, 2000);\r\n     *\r\n     * fx(element) // Animation the element over 2000 milliseconds.\r\n     *\r\n     * @param element\r\n     * @param config\r\n     * @returns {function(HTMLElement element, Number duration, Object config): FX}\r\n     */\r\n    bind(element = null, config = null) {\r\n        let defaults = {\r\n            element,\r\n            config\r\n        };\r\n\r\n        return (element = defaults, config=null) => {\r\n            element = element === defaults ? element.defaults : element;\r\n\r\n            let _options = {};\r\n            if (defaults.config) Object.assign(_options, defaults.config);\r\n            if (config) Object.assign(_options, config);\r\n\r\n            return this.animate(element, _options);\r\n        };\r\n    }\r\n}\r\n","import {ExtendableError} from \"../errors\";\r\nimport {selectElement} from \"../utility\";\r\nimport {RGBA} from \"../vectors\";\r\nimport {NumberWithUnit} from \"./types\";\r\nimport {EASING} from \"./easing\";\r\nimport {defaultApplyFrame} from \"./frame\";\r\n\r\n\r\nconst regNumberWithUnit = /^(\\d+\\.?\\d*)([a-z]+|%)$/i,\r\n    regColor = /^(?:#([a-f0-9]{3})|#([a-f0-9]{6})|#([a-f0-9]{8}))$/i,\r\n    regFunction = /^([a-z_][a-z_0-9]*)\\((.+?)\\)$/i;\r\n\r\n\r\nconst TYPE_FUNCTIONS = {\r\n    hex: RGBA.parseHexColorStringArg,\r\n    rgb: RGBA.parseRGBAColorStringArgs,\r\n    rgba: RGBA.parseRGBAColorStringArgs\r\n};\r\n\r\n\r\nexport class DeadFXError extends ExtendableError {}\r\n\r\n\r\nfunction assertFXAlive(fx) {\r\n    if (fx.status === FX.complete || fx.status === FX.error || fx.status === FX.complete) {\r\n        throw new DeadFXError(\"FX object is dead.\");\r\n    }\r\n}\r\n\r\n\r\nfunction doPromiseAction(onAction, value, resolveOrReject) {\r\n    if (typeof onAction === 'function') {\r\n        value = onAction(value);\r\n    }\r\n\r\n    resolveOrReject(value);\r\n}\r\n\r\n\r\nfunction _prepareValue(value) {\r\n    if (typeof value === 'string') {\r\n        value = value.trim();\r\n\r\n        let m = regNumberWithUnit.exec(value);\r\n\r\n        if (m) {\r\n            return new NumberWithUnit(parseFloat(m[1]), m[2]);\r\n        }\r\n\r\n        m = regColor.exec(value);\r\n\r\n        if (m) {\r\n            return TYPE_FUNCTIONS.hex(m[0]);\r\n        }\r\n\r\n        m = regFunction.exec(value);\r\n\r\n        if (m) {\r\n            return TYPE_FUNCTIONS[m[1]](m[2]);\r\n        }\r\n    }\r\n\r\n    return value;\r\n}\r\n\r\n\r\nfunction _getFrames(fx, element, frames) {\r\n    let r = {};\r\n\r\n    if (typeof frames === 'function') {\r\n        frames = frames.call(fx, element, fx);\r\n    }\r\n\r\n    for (let keyframeIndex in frames) {\r\n        if (!frames.hasOwnProperty(keyframeIndex)) continue;\r\n\r\n        let frame = frames[keyframeIndex];\r\n        r[keyframeIndex] = {};\r\n\r\n        for (let property in frame) {\r\n            if (!frame.hasOwnProperty(property)) continue;\r\n            r[keyframeIndex][property] = _prepareValue(frame[property]);\r\n        }\r\n    }\r\n\r\n    return r;\r\n}\r\n\r\n\r\n/**\r\n * @implements Promise\r\n */\r\nexport default class FX {\r\n    static pending = \"Pending\";\r\n    static complete = \"Complete\";\r\n    static error = \"Error\";\r\n    static paused = \"Paused\";\r\n    static canceled = \"Canceled\";\r\n    static playing = \"Playing\";\r\n\r\n    #element;\r\n    #chained;\r\n    #frames;\r\n    #internalValue;\r\n\r\n    #animation;\r\n\r\n    #frameId;\r\n    #status;\r\n    #position;\r\n\r\n    #finishFrame;\r\n    #applyFrame;\r\n    #easing;\r\n    #duration;\r\n\r\n    [Symbol.toStringTag] = \"[Object FX]\";\r\n\r\n    constructor(element, frames, duration, {applyFrame = defaultApplyFrame, animation = null, easing = EASING.linear, onComplete = null, onCancel = null, onFrame = null, onStart = null, onEnd = null, bubbleFrameEvent = false, finishFrame = null, init = null} = {}) {\r\n        this.#frames = [];\r\n        this.#chained = [];\r\n        this.#element = selectElement(element);\r\n        this.#internalValue = undefined;\r\n\r\n        this.onComplete = onComplete;\r\n        this.onCancel = onCancel;\r\n        this.onFrame = onFrame;\r\n        this.onStart = onStart;\r\n        this.onEnd = onEnd;\r\n        this.bubbleFrameEvent = bubbleFrameEvent;\r\n\r\n        this.#animation = animation;\r\n        this.#finishFrame = finishFrame;\r\n        this.#applyFrame = applyFrame;\r\n        this.#easing = easing;\r\n        this.#frameId = null;\r\n        this.#status = FX.pending;\r\n\r\n        this.#duration = duration;\r\n        this.#position = 0;\r\n\r\n        if (init) {\r\n            init.call(this, this);\r\n        }\r\n\r\n        // Prepare frames\r\n        frames = _getFrames(this, this.#element, frames);\r\n\r\n        for (let key in frames) {\r\n            if (frames.hasOwnProperty(key)) {\r\n                let frame = frames[key],\r\n                    pos = parseFloat(key) / 100;\r\n\r\n                if (typeof frame === 'function') {\r\n                    frame = frame.call(this, this.#element);\r\n                }\r\n\r\n                frame = Object.freeze(Object.assign({}, frame));\r\n\r\n                this.#frames.push(Object.freeze({\r\n                    position: pos,\r\n                    properties: frame\r\n                }));\r\n            }\r\n        }\r\n\r\n        this.#frames.sort((a, b) => a.position - b.pos);\r\n    }\r\n\r\n    get animation() {\r\n        return this.#animation;\r\n    }\r\n\r\n    // noinspection JSUnusedGlobalSymbols\r\n    get easing() {\r\n        return this.#easing;\r\n    }\r\n\r\n    get status() {\r\n        return this.#status;\r\n    }\r\n\r\n    get position() {\r\n        return this.#position;\r\n    }\r\n\r\n    // noinspection JSUnusedGlobalSymbols\r\n    get duration() {\r\n        return this.#duration;\r\n    }\r\n\r\n    // noinspection JSUnusedGlobalSymbols\r\n    get frames() {\r\n        return this.#frames.slice();\r\n    }\r\n\r\n    get element() {\r\n        return this.#element;\r\n    }\r\n\r\n    // set position(value) {\r\n    //     if (typeof value === 'string') {\r\n    //         value = (parseFloat(value) / 100) * this.#duration;\r\n    //     }\r\n    //\r\n    //     this.#position = Math.max(0.0, Math.min(this.#duration, value));\r\n    // }\r\n\r\n    get state() {\r\n        if (this.status === FX.complete || this.status === FX.canceled) {\r\n            return \"Fulfilled\";\r\n        } else if (this.status === FX.error) {\r\n            return \"Rejected\";\r\n        } else {\r\n            return \"Pending\";\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Returns the frame options at the given position.\r\n     * @param position\r\n     */\r\n    getFrameFX(position) {\r\n        // position can either be a percentage string (aka 50%) or the time in milliseconds into the animation\r\n        // which will be converted into a percentage.\r\n        if (typeof position === 'string') {\r\n            position = parseFloat(position) / 100;\r\n        }\r\n\r\n        // At this point position should be a value between 0.0 and 1.0.\r\n        // Easing functions specify that rate of change in the properties.\r\n        // It takes the position and maps it to another value between 0.0f and 1.0f.\r\n        // By default linear easing is used.\r\n        if (this.#easing) {\r\n            position = this.#easing(position);\r\n        }\r\n\r\n        let r = {};\r\n\r\n        for (let frame of this.#frames) {\r\n            for (let key in frame.properties) {\r\n                if (frame.properties.hasOwnProperty(key)) {\r\n                    let value = frame.properties[key];\r\n\r\n                    if (!r[key]) {\r\n                        r[key] = {startPosition: null, startValue: null, endPosition: null, endValue: null};\r\n                    }\r\n\r\n                    if (frame.position <= position) {\r\n                        r[key].startPosition = frame.position;\r\n                        r[key].startValue = value;\r\n                    } else if (frame.position > position && r[key].endPosition === null) {\r\n                        r[key].endPosition = frame.position;\r\n                        r[key].endValue = value;\r\n                    }\r\n                }\r\n            }\r\n        }\r\n\r\n        return r;\r\n    }\r\n\r\n    /**\r\n     * Returns the final frame at the given position.  All options at this point should be parsed and there final values\r\n     * should be available.\r\n     *\r\n     * @param position\r\n     */\r\n    getFrame(position) {\r\n        let frame = this.getFrameFX(position),\r\n            r = {};\r\n\r\n        if (typeof position === 'string') {\r\n            position = parseFloat(position) / 100;\r\n        }\r\n\r\n        // Takes the frame config options and calculates the final values.\r\n        for (let property in frame) {\r\n            if (frame.hasOwnProperty(property)) {\r\n                let options = frame[property];\r\n\r\n                if ((options.endPosition === null || options.endPosition <= position) && options.startValue !== null) {\r\n                    r[property] = options.startValue;\r\n                } else if (options.startValue !== null) {\r\n                    if (typeof options.startValue === 'object') {\r\n                        let p = (position - options.startPosition) / (options.endPosition - options.startPosition),\r\n                            delta = options.endValue.subtract(options.startValue);\r\n\r\n                        r[property] = options.startValue.add(delta.scalar(p));\r\n                    } else if (typeof options.startValue === 'number') {\r\n                        let duration = (options.endPosition - options.startPosition),\r\n                            p = (position - options.startPosition) / duration,\r\n                            delta = options.endValue - options.startValue;\r\n\r\n                        r[property] = options.startValue + (delta * p);\r\n                    } else {\r\n                        r[property] = options.startValue;\r\n                    }\r\n                }\r\n            }\r\n        }\r\n\r\n        // User provided hook that can perform the final touch ups on the frame.\r\n        if (this.#finishFrame) {\r\n            r = this.#finishFrame(this, frame);\r\n        }\r\n\r\n        return r;\r\n    }\r\n\r\n    play() {\r\n        assertFXAlive(this);\r\n\r\n        if (this.#frameId === null) {\r\n            this.goto(this.#position);\r\n\r\n            let tick = performance.now();\r\n\r\n            let frameFN = () => {\r\n                let timestamp = performance.now(),\r\n                    delta = timestamp - tick,\r\n                    position = this.#position + (delta / this.duration);\r\n\r\n                tick = timestamp;\r\n                let frame = this.goto(position);\r\n                this.#status = FX.playing;\r\n\r\n                if (this.onFrame) this.onFrame.call(this, this, frame);\r\n\r\n                this.#element.dispatchEvent(new CustomEvent('animation.frame', {\r\n                    bubbles: this.bubbleFrameEvent,\r\n                    detail: this\r\n                }));\r\n\r\n                if (this.#position < 1) {\r\n                    this.#frameId = window.requestAnimationFrame(frameFN);\r\n                } else {\r\n                    this._complete(FX.complete, FX.complete);\r\n                    this.#frameId = null;\r\n                }\r\n            };\r\n\r\n            if (this.onStart) {\r\n                this.onStart.call(this, this);\r\n            }\r\n\r\n            this.#element.dispatchEvent(new CustomEvent('animation.start', {\r\n                bubbles: true,\r\n                detail: this\r\n            }));\r\n\r\n            this.#frameId = window.requestAnimationFrame(frameFN);\r\n        }\r\n\r\n        return this;\r\n    }\r\n\r\n    // noinspection JSUnusedGlobalSymbols\r\n    /**\r\n     * Pauses the animation.  Does not resolve it.\r\n     * @returns {FX}\r\n     */\r\n    pause() {\r\n        if (this.#frameId) {\r\n            window.cancelAnimationFrame(this.#frameId);\r\n            this.#frameId = null;\r\n            this.#status = FX.paused;\r\n\r\n            this.#element.dispatchEvent(new CustomEvent('animation.paused', {\r\n                bubbles: true,\r\n                detail: this\r\n            }));\r\n        }\r\n\r\n        return this;\r\n    }\r\n\r\n    _cancel(complete = false, status = FX.canceled) {\r\n        if (this.#frameId) {\r\n            window.cancelAnimationFrame(this.#frameId);\r\n            this.#frameId = null;\r\n\r\n            if (complete) {\r\n                this.goto(1);\r\n                this._complete(status, status);\r\n            } else {\r\n                this.#status = status;\r\n                this.#internalValue = status;\r\n            }\r\n\r\n            if (this.onCancel) this.onCancel.call(this, this);\r\n\r\n            this.#element.dispatchEvent(new CustomEvent('animation.canceled', {\r\n                bubbles: true,\r\n                detail: this\r\n            }));\r\n\r\n            this._triggerEndEvent();\r\n        }\r\n\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * Cancel the animation with the canceled state.   optionally sets the animation to it's final frame if\r\n     * completeAnimation is true.\r\n     *\r\n     * @param completeAnimation\r\n     * @returns {FX}\r\n     */\r\n    cancel(completeAnimation = false) {\r\n        return this._cancel(completeAnimation, FX.canceled);\r\n    }\r\n\r\n    /**\r\n     * Completes the animation immediately and sets is status to complete.\r\n     * @returns {FX}\r\n     */\r\n    complete() {\r\n        return this._cancel(true, FX.complete);\r\n    }\r\n\r\n    goto(position) {\r\n        assertFXAlive(this);\r\n\r\n        if (typeof position === 'string') {\r\n            position = parseFloat(position) / 100;\r\n        }\r\n\r\n        this.#position = position;\r\n        return this.applyFrame(this.position);\r\n    }\r\n\r\n    applyFrame(position) {\r\n        let frame = this.getFrame(position);\r\n        this.#applyFrame.call(this, this, frame);\r\n        return frame;\r\n    }\r\n\r\n    _triggerEndEvent() {\r\n        if (this.onEnd) this.onEnd.call(this, this);\r\n\r\n        this.#element.dispatchEvent(new CustomEvent('animation.end', {\r\n            bubbles: true,\r\n            detail: this\r\n        }));\r\n\r\n        for (let {onResolve} of this.#chained) {\r\n            if (onResolve) onResolve(this.#internalValue);\r\n        }\r\n        this.#chained = [];\r\n    }\r\n\r\n    _complete(value, status = FX.complete) {\r\n        if (this.state !== \"Pending\") {\r\n            return;\r\n        }\r\n\r\n        this.#status = status;\r\n        this.#internalValue = value;\r\n\r\n        if (this.onComplete) this.onComplete.call(this, this);\r\n\r\n        this.#element.dispatchEvent(new CustomEvent('animation.complete', {\r\n            bubbles: true,\r\n            detail: this\r\n        }));\r\n\r\n        this._triggerEndEvent();\r\n    }\r\n\r\n    then(onResolve, onReject) {\r\n        if (this.state === \"Pending\") {\r\n            return new Promise((resolve, reject) => {\r\n                // noinspection JSUnusedGlobalSymbols\r\n                this.#chained.push({\r\n                    onResolve: (value) => {\r\n                        doPromiseAction(onResolve, value, resolve);\r\n                    },\r\n\r\n                    onReject: (value) => {\r\n                        doPromiseAction(onReject, value, reject);\r\n                    }\r\n                });\r\n            });\r\n        } else if (this.state === 'Fulfilled' && typeof onResolve === 'function') {\r\n            return new Promise((resolve) => {\r\n                doPromiseAction(onResolve, this.#internalValue, resolve);\r\n            });\r\n        } else if (this.state === 'Rejected' && typeof onReject === 'function') {\r\n            return new Promise((resolve, reject) => {\r\n                doPromiseAction(onReject, this.#internalValue, reject);\r\n            });\r\n        }\r\n    }\r\n\r\n    // noinspection JSUnusedGlobalSymbols\r\n    finally(onFinally) {\r\n        onFinally = (value) => {\r\n            if (typeof onFinally === 'function') {\r\n                onFinally();\r\n            }\r\n\r\n            return value;\r\n        };\r\n\r\n        return this.then(onFinally, onFinally);\r\n    }\r\n\r\n    // noinspection JSUnusedGlobalSymbols\r\n    catch(onReject) {\r\n        return this.then(undefined, onReject);\r\n    }\r\n}\r\n","/**\r\n *\r\n * @param p\r\n * @returns {*}\r\n */\r\nexport function linear(p) {\r\n    return p;\r\n}\r\n\r\n\r\n// noinspection JSUnusedGlobalSymbols\r\nexport const EASING = {\r\n    linear: linear\r\n};\r\n","export function defaultApplyFrame(fx, frame) {\r\n    for (let key in frame) {\r\n        if (frame.hasOwnProperty(key)) {\r\n            fx.element.style[key] = frame[key].toString();\r\n        }\r\n    }\r\n}\r\n","export class NumberWithUnit {\r\n    constructor(value, unit) {\r\n        this.value = value;\r\n        this.unit = unit;\r\n    }\r\n\r\n    add(value) {\r\n        if (typeof value !== \"number\") {\r\n            if (!(value instanceof NumberWithUnit)) {\r\n                throw new TypeError(\"Cannot perform action on invalid type.\");\r\n            }\r\n\r\n            if (this.unit !== value.unit) {\r\n                throw new Error(\"Mismatched units\");\r\n            }\r\n\r\n            value = value.value;\r\n        }\r\n\r\n\r\n        return new NumberWithUnit(this.value + value, this.unit);\r\n    }\r\n\r\n    subtract(value) {\r\n        if (typeof value !== \"number\") {\r\n            if (!(value instanceof NumberWithUnit)) {\r\n                throw new TypeError(\"Cannot perform action on invalid type.\");\r\n            }\r\n\r\n            if (this.unit !== value.unit) {\r\n                throw new Error(\"Mismatched units\");\r\n            }\r\n\r\n            value = value.value;\r\n        }\r\n\r\n        return new NumberWithUnit(this.value - value, this.unit);\r\n    }\r\n\r\n    scalar(value) {\r\n        if (typeof value !== \"number\") {\r\n            if (!(value instanceof NumberWithUnit)) {\r\n                throw new TypeError(\"Cannot perform action on invalid type.\");\r\n            }\r\n\r\n            if (this.unit !== value.unit) {\r\n                throw new Error(\"Mismatched units\");\r\n            }\r\n\r\n            value = value.value;\r\n        }\r\n\r\n        return new NumberWithUnit(this.value * value, this.unit);\r\n    }\r\n\r\n    // noinspection JSUnusedGlobalSymbols\r\n    divide(value) {\r\n        if (typeof value !== \"number\") {\r\n            if (!(value instanceof NumberWithUnit)) {\r\n                throw new TypeError(\"Cannot perform action on invalid type.\");\r\n            }\r\n\r\n            if (this.unit !== value.unit) {\r\n                throw new Error(\"Mismatched units\");\r\n            }\r\n\r\n            value = value.value;\r\n        }\r\n\r\n        return new NumberWithUnit(this.value / value, this.unit);\r\n    }\r\n\r\n    toString() {\r\n        return `${this.value}${this.unit}`;\r\n    }\r\n}\r\n","import Publisher from \"../Publisher\";\r\nimport {calcDistance, clamp} from \"../utility\";\r\nimport Rect from \"../vectors/Rect\";\r\nimport {getScroll} from \"../utility\";\r\nimport {setElementClientPosition} from \"./position\";\r\nimport Animation from \"../fx/Animation\";\r\n\r\n\r\nconst reg_percentage_test = /\\s*\\d+\\.?\\d*%\\s*/;\r\n\r\n\r\n/**\r\n * Returns the offset position of the mouse relative to the target.\r\n *\r\n * @param target\r\n * @param event\r\n * @returns {{x: number, y: number}}\r\n */\r\nexport function cursor(target, event) {\r\n    let rect = new Rect(target);\r\n\r\n    return {\r\n        x: event.clientX - rect.left,\r\n        y: event.clientY - rect.top\r\n    };\r\n}\r\n\r\n\r\nfunction buildTestIntersectionFunction(amount) {\r\n    return function(element, rect) {\r\n        rect = new Rect(rect);\r\n\r\n        let targetRect = new Rect(element),\r\n            intersection = targetRect.intersection(rect),\r\n            p = intersection ? intersection.getArea() / rect.getArea() : 0;\r\n\r\n        return p > amount;\r\n    }\r\n}\r\n\r\n\r\nexport default class Draggable2 extends Publisher {\r\n    #element;\r\n    #droppables;\r\n    #boundOnMouseDown;\r\n    #itemCache;\r\n\r\n    constructor(element, {container=null, axis='xy', exclude='', delay=0, offset=cursor,\r\n        resistance=0, handle=null, helper=null, revert=false, revertDuration=0,\r\n        scrollSpeed=0, selector=null, tolerance=0.5, setHelperSize=false, grid=null}={}) {\r\n        super();\r\n\r\n        if(typeof element === 'string') {\r\n            this.#element = document.querySelector(element);\r\n        } else {\r\n            this.#element = element;\r\n        }\r\n\r\n        this.#droppables = [];\r\n        this.#itemCache = new WeakMap();\r\n\r\n        this.container = container;\r\n        this.axis = axis;\r\n        this.exclude = exclude;\r\n        this.delay = delay;\r\n        this.offset = offset;\r\n        this.resistance = resistance;\r\n        this.handle = handle;\r\n        this.helper = helper;\r\n        this.revert = revert;\r\n        this.revertDuration = revertDuration;\r\n        this.scrollSpeed = scrollSpeed;\r\n        this.selector = selector;\r\n        this.tolerance = tolerance;\r\n        this.setHelperSize = setHelperSize;\r\n        this.grid = grid;\r\n\r\n        if(typeof this.container === 'string') {\r\n            this.container = document.querySelector(this.container);\r\n        }\r\n\r\n        this.#boundOnMouseDown = event => {\r\n            return this.onMouseDown(event);\r\n        };\r\n\r\n        this.element.addEventListener('mousedown', this.#boundOnMouseDown);\r\n    }\r\n\r\n    /**\r\n     * Starts dragging if the correct elements have been targeted and delay and resistance have been meet.\r\n     *\r\n     * @param event\r\n     * @returns {Promise<void>}\r\n     */\r\n    async onMouseDown(event) {\r\n        let startPosition = {x: event.clientX + window.pageXOffset, y: event.clientY + window.pageYOffset},\r\n            currentPosition = {x: startPosition.x, y: startPosition.y},\r\n            target = this.#element,\r\n            cancelMouseTracking = null,\r\n            cancelTimer = null,\r\n            distanceBrokenPromise,\r\n            timerPromise,\r\n            offset;\r\n\r\n        // Only start dragging if a draggable child of the element is targeted.\r\n        // If selector is null then the entire element is draggable and should be the target.\r\n        if(this.selector) {\r\n            target = event.target.closest(this.selector);\r\n\r\n            if(!target || !this.#element.contains(target)) {\r\n                return;\r\n            }\r\n        }\r\n\r\n        // Only start dragging if the handle was targeted.\r\n        // If handle is null then the entire target is the handle.\r\n        if(this.handle) {\r\n            let handle = event.target.closest(this.handle);\r\n\r\n            if(!handle || !target.contains(handle)) {\r\n                return;\r\n            }\r\n        }\r\n\r\n        // If any excluded elements are targeted ignore the event.\r\n        if(this.exclude) {\r\n            let exclude = event.target.closest(this.exclude);\r\n\r\n            if(exclude && target.contains(exclude)) {\r\n                return;\r\n            }\r\n        }\r\n\r\n        // Find the offset of the event.\r\n        if(typeof this.offset === 'function') {\r\n            offset = this.offset(target, event);\r\n        } else if(Array.isArray(this.offset)) {\r\n            offset = {\r\n                x: this.offset[0],\r\n                y: this.offset[1]\r\n            };\r\n        } else if(typeof this.offset === 'object') {\r\n            offset = {\r\n                x: this.offset.x,\r\n                y: this.offset.y\r\n            };\r\n        } else {\r\n            offset = {x: 0, y: 0};\r\n        }\r\n\r\n        // Prevent default browser actions.\r\n        event.preventDefault();\r\n\r\n        // At this point we can be sure that a draggable item was\r\n        // targeted by it's handle and no excluded items where clicked.\r\n\r\n        // Creates a promise that both tracks the current mouse coords and resolve\r\n        // when the user passes the given resistance.\r\n        distanceBrokenPromise = new Promise(resolve => {\r\n            let isDistanceBroken = this.resistance <= 0;\r\n\r\n            if(isDistanceBroken) {\r\n                resolve('complete');\r\n            }\r\n\r\n            let onMouseMove = event => {\r\n                currentPosition.x = event.clientX + window.pageXOffset;\r\n                currentPosition.y = event.clientY + window.pageYOffset;\r\n                event.preventDefault();\r\n\r\n                if(!isDistanceBroken && calcDistance(currentPosition.x, currentPosition.y, startPosition.x, startPosition.y) > this.resistance) {\r\n                    resolve('complete');\r\n                    isDistanceBroken = true;\r\n                }\r\n            };\r\n\r\n            // Cancel mouse tracking and resolve the promise to canceled if hasn't already been resolve.\r\n            // This function must be called or their will be a memory leak before onMouseDown completes.\r\n            cancelMouseTracking = () => {\r\n                if(onMouseMove) {\r\n                    document.removeEventListener('mousemove', onMouseMove);\r\n\r\n                    if(!isDistanceBroken) {\r\n                        resolve('canceled');\r\n                    }\r\n\r\n                    onMouseMove = null;\r\n                }\r\n            };\r\n\r\n            document.addEventListener('mousemove', onMouseMove);\r\n        });\r\n\r\n        // Creates a promise that resolve when after the delay time passes or the user cancels the drag by\r\n        // releasing the mouse button.\r\n        timerPromise = new Promise(resolve => {\r\n            let timer = null;\r\n\r\n            if(this.delay >= 0) {\r\n                timer = setTimeout(() => {\r\n                    resolve(\"complete\");\r\n                    timer = null;\r\n                }, this.delay);\r\n            } else {\r\n                resolve('complete');\r\n            }\r\n\r\n            // cancel the timer and resolve it to canceled if it is still active.\r\n            cancelTimer = () => {\r\n                if(timer) {\r\n                    clearTimeout(timer);\r\n                    resolve('canceled');\r\n                }\r\n            };\r\n        });\r\n\r\n        // cancel the timer and mouse tracking if they are still active.\r\n        let onMouseUp = event => {\r\n            event.preventDefault();\r\n            cancelTimer();\r\n            cancelMouseTracking();\r\n            document.removeEventListener('mouseup', onMouseUp);\r\n        };\r\n\r\n        document.addEventListener('mouseup', onMouseUp);\r\n\r\n        // Wait until the delay time and distance have passed or failed.\r\n        let [timerStatus, distanceStatus] = await Promise.all([timerPromise, distanceBrokenPromise]);\r\n\r\n        // Ensure that mouse tracking has been canceled.\r\n        if(cancelMouseTracking) cancelMouseTracking();\r\n\r\n        // At this point both the timer and distance status should have passed or failed.\r\n        // If either failed do nothing.\r\n        if(timerStatus === 'complete' && distanceStatus === 'complete') {\r\n            this.startDragging(target, {\r\n                offsetX: offset.x,\r\n                offsetY: offset.y,\r\n                // Make relative to client.\r\n                startingX: currentPosition.x,\r\n                startingY: currentPosition.y\r\n            });\r\n        }\r\n    }\r\n\r\n    async startDragging(element, pos) {\r\n        let cache = this.#itemCache.get(element),\r\n            mousePosition = {x: pos.startingX, y: pos.startingY};\r\n\r\n        if(!cache) {\r\n            cache = {isDragging: false, fx: null, rect: null, helper: null, element: element};\r\n            this.#itemCache.set(element, cache);\r\n        }\r\n\r\n        if(cache.isDragging) {\r\n            return;\r\n        }\r\n\r\n        cache.isDragging = true;\r\n\r\n        if(cache.fx) {\r\n            await cache.fx.cancel();\r\n            cache.fx = null;\r\n        }\r\n\r\n        let target = element,\r\n            container = this.container,\r\n            scroller = null,\r\n            dropTargets = [],\r\n            startPosition = new Rect(element),\r\n            startingClientRect = startPosition;\r\n\r\n        startPosition = startPosition.translate(\r\n            window.pageXOffset,\r\n            window.pageYOffset\r\n        );\r\n\r\n        if(!cache.rect) {\r\n            cache.rect = startPosition;\r\n        }\r\n\r\n        if(typeof container === 'string') {\r\n            container = document.querySelector(container);\r\n        }\r\n\r\n        if(this.helper) {\r\n            if(typeof this.helper === 'function') {\r\n                target = this.helper(element);\r\n            } else {\r\n                target = this.helper;\r\n            }\r\n\r\n            if(this.setHelperSize) {\r\n                target.style.width = startPosition.width + \"px\";\r\n                target.style.height = startPosition.height + \"px\";\r\n            }\r\n\r\n            target.style.pointerEvents = 'none';\r\n\r\n            if(!target.parentElement && element.parentElement) {\r\n                element.parentElement.appendChild(target);\r\n            }\r\n\r\n            target.classList.add('ui-drag-helper');\r\n\r\n            cache.helper = target;\r\n        }\r\n\r\n        let refreshDropTargets = (rect) => {\r\n            // drag-enter\r\n            let mouseX = mousePosition.x - window.pageXOffset,\r\n                mouseY = mousePosition.y - window.pageYOffset,\r\n                currentDropTargets,\r\n                detail = {clientX: mouseX, clientY: mouseY};\r\n\r\n            if(rect !== null) {\r\n                currentDropTargets = this.getDropTargets(rect, {mouseX, mouseY});\r\n            } else {\r\n                currentDropTargets = [];\r\n            }\r\n\r\n            for(let dropTarget of currentDropTargets) {\r\n                if(dropTargets.indexOf(dropTarget) === -1) {\r\n                    dispatchDropEvent(this, 'drag.enter', element, target, null, rect, true, true, false, detail, dropTarget);\r\n                }\r\n            }\r\n\r\n            for(let dropTarget of dropTargets) {\r\n                if(currentDropTargets.indexOf(dropTarget) === -1) {\r\n                    dispatchDropEvent(this, 'drag.leave', element, target, null, rect, true, true, false, detail, dropTarget);\r\n                }\r\n            }\r\n\r\n            // drag-leave\r\n            dropTargets = currentDropTargets;\r\n        };\r\n\r\n        let onMouseMove = event => {\r\n            event.preventDefault();\r\n            let rect = _moveElementToPosition(this, target, event.clientX, event.clientY, pos.offsetX, pos.offsetY, _selectElementRect(container, this, target, element));\r\n\r\n            mousePosition.x = event.clientX + window.pageXOffset;\r\n            mousePosition.y = event.clientY + window.pageYOffset;\r\n\r\n            if(this.scrollSpeed > 0) {\r\n                if(scroller) {\r\n                    scroller.cancel();\r\n                    scroller = null;\r\n                }\r\n\r\n                scroller = ScrollHelper.buildScrollHelper(element, target, rect, pos, this, event, this.scrollSpeed, container);\r\n            }\r\n\r\n            refreshDropTargets(rect);\r\n\r\n            publishDragMoveEvent(this, element, target, event, rect);\r\n        };\r\n\r\n        let onMouseUp = async event => {\r\n            event.preventDefault();\r\n            document.removeEventListener('mousemove', onMouseMove);\r\n            document.removeEventListener('mouseup', onMouseUp);\r\n            cache.isDragging = false;\r\n            element.classList.remove('ui-dragging');\r\n\r\n            if(scroller) {\r\n                scroller.cancel();\r\n                scroller = null;\r\n            }\r\n\r\n            let accepted = false,\r\n                isDefaultPrevented = false,\r\n                reverted = false,\r\n                rect = new Rect(target);\r\n\r\n            publishDragDropEvent(this, element, target, event, rect, false, {\r\n                isDefaultPrevented() {\r\n                    return isDefaultPrevented;\r\n                },\r\n\r\n                isAccepted() {\r\n                    return accepted;\r\n                },\r\n\r\n                accept() {\r\n                    accepted = true;\r\n                },\r\n\r\n                preventDefault() {\r\n                    isDefaultPrevented = true;\r\n                }\r\n            });\r\n\r\n            if(this.revert && !accepted) {\r\n                refreshDropTargets(cache.rect);\r\n                rect = cache.rect;\r\n\r\n                if(!this.revertDuration) {\r\n                    if(target !== element) {\r\n                        target.parentElement.removeChild(target);\r\n                    } else {\r\n                        let pos = startPosition.translate(\r\n                            -window.pageXOffset,\r\n                            -window.pageYOffset\r\n                        );\r\n\r\n                        setElementClientPosition(target, pos, 'translate3d');\r\n                    }\r\n                } else {\r\n                    cache.fx = _revert(target, cache.rect, this.revertDuration);\r\n\r\n                    await cache.fx;\r\n\r\n                    if(target !== element) {\r\n                        target.parentElement.removeChild(target);\r\n                    }\r\n                }\r\n\r\n                reverted = true;\r\n            } else {\r\n                if(target !== element) {\r\n                    target.parentElement.removeChild(target);\r\n                    setElementClientPosition(element, rect, 'translate3d');\r\n                }\r\n            }\r\n\r\n            this.#itemCache.delete(element);\r\n\r\n            dispatchDropEvent(this, 'drag.end', element, target, event, rect, true, true, true, {accepted, reverted}, element);\r\n        };\r\n\r\n        // Set target to starting position.\r\n        if(mousePosition.x !== undefined && mousePosition.y !== undefined) {\r\n            let rect = _moveElementToPosition(this, target, mousePosition.x - window.pageXOffset, mousePosition.y - window.pageYOffset, pos.offsetX, pos.offsetY, _selectElementRect(container, this, target, element));\r\n            refreshDropTargets(rect);\r\n        }\r\n\r\n        document.addEventListener('mousemove', onMouseMove);\r\n        document.addEventListener('mouseup', onMouseUp);\r\n        element.classList.add('ui-dragging');\r\n\r\n        dispatchDropEvent(this, 'drag.start', element, target, null, startingClientRect, true, true, true, null);\r\n    }\r\n\r\n    getDropTargets(rect, mousePos) {\r\n        let r = [];\r\n\r\n        /**\r\n         * @type {number|String|Function|string}\r\n         */\r\n        let testFunction = this.tolerance,\r\n            type = typeof testFunction;\r\n\r\n        if(type === 'string') {\r\n            // noinspection JSCheckFunctionSignatures\r\n            if(reg_percentage_test.test(testFunction)) {\r\n                // noinspection JSCheckFunctionSignatures\r\n                testFunction = buildTestIntersectionFunction(parseFloat(testFunction) / 100);\r\n            }\r\n        } else if(type === 'number') {\r\n            testFunction = buildTestIntersectionFunction(testFunction);\r\n        }\r\n\r\n        for(let droppable of this.#droppables) {\r\n            if(testFunction(droppable, rect, mousePos, this)) {\r\n                r.push(droppable);\r\n            }\r\n        }\r\n\r\n        return r;\r\n    }\r\n\r\n    connect(droppables) {\r\n        if(typeof droppables === 'string') {\r\n            droppables = document.querySelectorAll(droppables);\r\n        } else if(typeof droppables.length !== 'number') {\r\n            droppables = [droppables];\r\n        }\r\n\r\n        for(let i = 0; i < droppables.length; i++) {\r\n            let item = droppables[i];\r\n\r\n            if(this.#droppables.indexOf(item) === -1) {\r\n                this.#droppables.push(item);\r\n            }\r\n        }\r\n    }\r\n\r\n    // noinspection JSUnusedGlobalSymbols\r\n    disconnect(droppable) {\r\n        if(typeof droppable === 'string') {\r\n            droppable = document.querySelector(droppable);\r\n        }\r\n\r\n        let i = this.#droppables.indexOf(droppable);\r\n\r\n        if(i !== -1) {\r\n            this.#droppables.splice(i, 1);\r\n        }\r\n    }\r\n\r\n    // noinspection JSUnusedGlobalSymbols\r\n    hasDroppable(droppable) {\r\n        if(typeof droppable === 'string') {\r\n            droppable = document.querySelector(droppable);\r\n        }\r\n\r\n        return this.#droppables.indexOf(droppable) !== -1;\r\n    }\r\n\r\n    // noinspection JSUnusedGlobalSymbols\r\n    get droppables() {\r\n        return this.#droppables.slice(0);\r\n    }\r\n\r\n    get element() {\r\n        return this.#element;\r\n    }\r\n}\r\n\r\n\r\nfunction _revert(target, position, revertDuration, onFrame=null) {\r\n    let starting = new Rect(target);\r\n\r\n    let animation = new Animation({\r\n        frames: {\r\n            '0%': {\r\n                left: starting.left + window.pageXOffset,\r\n                top: starting.top + window.pageYOffset\r\n            },\r\n\r\n            '100%': {\r\n                left: position.left,\r\n                top: position.top\r\n            }\r\n        },\r\n\r\n        applyFrame(fx, frame) {\r\n            setElementClientPosition(fx.element, {\r\n                left: frame.left - window.pageXOffset,\r\n                top: frame.top - window.pageYOffset\r\n            }, 'translate3d');\r\n\r\n            if(onFrame) onFrame(fx);\r\n        }\r\n    });\r\n\r\n    return animation.animate(target, {duration: revertDuration});\r\n}\r\n\r\n\r\n/**\r\n * Takes a client (x, y) position and some offset coords and move the element to the given position.\r\n *\r\n * @param self\r\n * @param element\r\n * @param x\r\n * @param y\r\n * @param offsetX\r\n * @param offsetY\r\n * @param container\r\n * @private\r\n * @returns {*|Rect}\r\n */\r\nfunction _moveElementToPosition(self, element, x, y, offsetX, offsetY, container) {\r\n    let rect = new Rect(element),\r\n        startingRect = rect;\r\n\r\n    rect = rect.moveTo({left: x, top: y});\r\n\r\n    offsetX = offsetX || 0;\r\n    offsetY = offsetY || 0;\r\n\r\n    rect = rect.translate(-offsetX, -offsetY);\r\n\r\n    if(self.axis === 'y') {\r\n        rect = new Rect(\r\n            startingRect.left,\r\n            rect.top,\r\n            startingRect.right,\r\n            rect.bottom\r\n        );\r\n    } else if(self.axis === 'x') {\r\n        rect = new Rect(\r\n            rect.left,\r\n            startingRect.top,\r\n            rect.right,\r\n            startingRect.bottom\r\n        );\r\n    }\r\n\r\n    if(typeof self.grid === 'number' && self.grid) {\r\n        let left = Math.floor(rect.left / self.grid) * self.grid,\r\n            top = Math.floor(rect.top / self.grid) * self.grid;\r\n\r\n        rect = new Rect(left, top, left + startingRect.width, top + startingRect.height);\r\n    }\r\n\r\n    if(container) {\r\n        container = new Rect(container);\r\n        rect = rect.fit(container);\r\n    }\r\n\r\n    setElementClientPosition(element, rect, 'translate3d');\r\n    return rect;\r\n}\r\n\r\n\r\n// noinspection JSCommentMatchesSignature\r\n/**\r\n * For module use only.  Selects the element either by css selector, if it's a string, or resolve a function.\r\n * If the element is already element is is returned direction.  Returns null if not element is provided.\r\n *\r\n * @param element\r\n * @param dragInstance\r\n * @param target\r\n * @returns {null|*}\r\n * @private\r\n */\r\nfunction _selectElementRect(element, dragInstance, target, originalTarget) {\r\n    if(element) {\r\n        let type = typeof element;\r\n\r\n        if(type === 'function') {\r\n            return new Rect(element.call(dragInstance, target, originalTarget, dragInstance));\r\n        } else if(type === 'string') {\r\n            return new Rect(document.querySelector(element));\r\n        }\r\n\r\n        return new Rect(element);\r\n    }\r\n\r\n    return null;\r\n}\r\n\r\n\r\n/**\r\n * Returns the first scrollable parent.\r\n *\r\n * @param element\r\n * @returns {HTMLElement|null}\r\n * @private\r\n */\r\nfunction _getScrollParent(element) {\r\n    let o = element.parentElement;\r\n\r\n    while(o) {\r\n        if (o.scrollWidth > o.clientWidth || o.scrollHeight > o.clientHeight) {\r\n            return o;\r\n        }\r\n\r\n        o = o.parentElement;\r\n    }\r\n\r\n    return null;\r\n}\r\n\r\n\r\nfunction _getScrollRect(element) {\r\n    if(element === window || element.nodeName === \"HTML\") {\r\n        return new Rect(0, 0, window.innerWidth, window.innerHeight);\r\n    } else {\r\n        return new Rect(element);\r\n    }\r\n}\r\n\r\n\r\n/**\r\n * Helper class that is used to control scrolling when the element is dragged outside of bounds.\r\n */\r\nclass ScrollHelper {\r\n    constructor(element, scrollXSpeed=0, scrollYSpeed=0, onFrame=null) {\r\n        this.frameID = null;\r\n        this.element = element;\r\n        this.scrollXSpeed = scrollXSpeed;\r\n        this.scrollYSpeed = scrollYSpeed;\r\n        this.onFrame = onFrame;\r\n        this.timestamp = performance.now();\r\n\r\n        let frame = timestamp => {\r\n            let delta = (timestamp - this.timestamp) / 1000;\r\n\r\n            this.timestamp = timestamp;\r\n\r\n            this.element.scrollLeft += delta * this.scrollXSpeed;\r\n            this.element.scrollTop += delta * this.scrollYSpeed;\r\n\r\n            if(this.onFrame) {\r\n                this.onFrame(this);\r\n            }\r\n\r\n            this.frameID = window.requestAnimationFrame(frame);\r\n        };\r\n\r\n        this.frameID = window.requestAnimationFrame(frame);\r\n    }\r\n\r\n    cancel() {\r\n        if(this.frameID) {\r\n            window.cancelAnimationFrame(this.frameID);\r\n            this.frameID = null;\r\n        }\r\n    }\r\n\r\n    static getScrollSpeed(rect, scrollParentRect) {\r\n        let r = {x: 0, y: 0};\r\n\r\n        if(rect.right > scrollParentRect.right) {\r\n            r.x = clamp((rect.right - scrollParentRect.right) / rect.width, -1, 1);\r\n        } else if(rect.left < scrollParentRect.left) {\r\n            r.x = clamp((rect.left - scrollParentRect.left) / rect.width, -1, 1);\r\n        }\r\n\r\n        if(rect.bottom > scrollParentRect.bottom) {\r\n            r.y = clamp((rect.bottom - scrollParentRect.bottom) / rect.width, -1, 1);\r\n        } else if(rect.top < scrollParentRect.top) {\r\n            r.y = clamp((rect.top - scrollParentRect.top) / rect.width, -1, 1);\r\n        }\r\n\r\n        return r;\r\n    }\r\n\r\n    static buildScrollHelper(element, target, rect, pos, dragInstance, event, scrollSpeed, container) {\r\n        let scrollParent = _getScrollParent(element);\r\n\r\n        if(scrollParent) {\r\n            let scrollParentRect = _getScrollRect(scrollParent),\r\n                speed = ScrollHelper.getScrollSpeed(rect, scrollParentRect);\r\n\r\n            if(speed.x || speed.y) {\r\n                return new ScrollHelper(scrollParent, speed.x * scrollSpeed, speed.y * scrollSpeed, (scroller) => {\r\n                    let rect = _moveElementToPosition(this, target, event.clientX, event.clientY, pos.offsetX, pos.offsetY, _selectElementRect(container, dragInstance, target, element));\r\n\r\n                    let scrollRect = new Rect(scroller.element);\r\n\r\n                    setElementClientPosition(target, rect, 'translate3d');\r\n\r\n                    if(scrollRect.contains(rect)) {\r\n                        scroller.cancel();\r\n                        scroller = null;\r\n                    }\r\n                });\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\n\r\nexport function ScrollArea(selector) {\r\n    return function() {\r\n        let element = selector;\r\n\r\n        if(typeof element === 'string') {\r\n            element = document.querySelector(element);\r\n        }\r\n\r\n        let rect = new Rect(element),\r\n            scroll = getScroll(element);\r\n\r\n        rect.left -= scroll.scrollLeft;\r\n        rect.top -= scroll.scrollTop;\r\n        rect.right = rect.left + element.scrollWidth;\r\n        rect.bottom = rect.top + element.scrollHeight;\r\n\r\n        return rect;\r\n    }\r\n}\r\n\r\n\r\nexport function clone(opacity=null, className=null, zIndex=null) {\r\n    if(typeof opacity === 'object' && opacity.nodeType) {\r\n        return opacity.cloneNode(true);\r\n    }\r\n\r\n    return function(element) {\r\n        let r = element.cloneNode(true);\r\n\r\n        if(opacity !== null) {\r\n            r.style.opacity = opacity;\r\n        }\r\n\r\n        if(className) {\r\n            r.className = className;\r\n        }\r\n\r\n        r.style.position = \"absolute\";\r\n        if(zIndex !== null) r.style.zIndex = zIndex;\r\n\r\n        return r;\r\n    }\r\n}\r\n\r\n\r\nfunction publishDragMoveEvent(self, element, helper, event, rect, bubbles=false, options=null) {\r\n    return dispatchDropEvent(self, 'drag.move', element, helper, event, rect, bubbles, true, true, options);\r\n}\r\n\r\n\r\nfunction publishDragDropEvent(self, element, helper, event, rect, bubbles=true, options=null) {\r\n    return dispatchDropEvent(self, 'drag.drop', element, helper, event, rect, bubbles, true, true, options);\r\n}\r\n\r\n\r\nfunction dispatchDropEvent(self, name, element, helper, originalEvent, currentRect, bubbles=false, dispatch=true, publish=false, detail=null, target=null) {\r\n    let eventPackage = {\r\n        name,\r\n        draggable: self,\r\n        target: helper,\r\n        element,\r\n        item: element, // alias for element\r\n        helper: helper,\r\n        originalEvent: null,\r\n        rect: currentRect\r\n    };\r\n\r\n    if(originalEvent) {\r\n        eventPackage.originalEvent = originalEvent;\r\n        eventPackage.clientX = originalEvent.clientX;\r\n        eventPackage.clientY = originalEvent.clientY;\r\n    }\r\n\r\n    if(!target) {\r\n        target = element;\r\n    }\r\n\r\n    if(detail) {\r\n        Object.assign(eventPackage, detail);\r\n    }\r\n\r\n    if(publish) {\r\n        self.publish(name, eventPackage);\r\n    }\r\n\r\n    if(dispatch) {\r\n        let customEvent = new CustomEvent(name, {\r\n            bubbles,\r\n            detail: eventPackage\r\n        });\r\n\r\n        target.dispatchEvent(customEvent);\r\n    }\r\n}\r\n"],"sourceRoot":""}