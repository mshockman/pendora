{"version":3,"sources":["webpack://pendora/./jekyll/js/pages/documentation/test_sortable.js","webpack://pendora/./src/core/fx/Animation.js","webpack://pendora/./src/core/fx/FX.js","webpack://pendora/./src/core/fx/easing.js","webpack://pendora/./src/core/fx/frame.js","webpack://pendora/./src/core/fx/types.js","webpack://pendora/./src/core/ui/Draggable.js","webpack://pendora/./src/core/ui/Sortable.js"],"names":["TestSortablePage","window","sortableGrid","Sortable","layout","setPlaceholderSize","sortableList1","droppables","placeholder","sortableList2","Animation","duration","frames","applyFrame","defaultApplyFrame","bubbleFrameEvent","finishFrame","element","easing","onStart","onFrame","onPause","onCancel","onEnd","onComplete","FX","animation","fx","EASING","linear","position","autoPlay","init","call","destroy","play","animate","complete","config","defaults","_options","Object","assign","canceled","paused","pending","error","playing","regNumberWithUnit","regColor","regFunction","TYPE_FUNCTIONS","hex","RGBA","parseHexColorStringArg","rgb","parseRGBAColorStringArgs","rgba","DeadFXError","ExtendableError","assertFXAlive","status","doPromiseAction","onAction","value","resolveOrReject","_prepareValue","trim","m","exec","NumberWithUnit","parseFloat","_getFrames","r","keyframeIndex","hasOwnProperty","frame","property","Symbol","toStringTag","selectElement","undefined","key","pos","freeze","push","properties","sort","a","b","startPosition","startValue","endPosition","endValue","getFrameFX","options","p","delta","subtract","add","scalar","tick","performance","now","frameFN","timestamp","dispatchEvent","CustomEvent","bubbles","detail","requestAnimationFrame","_complete","cancelAnimationFrame","_triggerEndEvent","completeAnimation","_cancel","getFrame","onResolve","state","onReject","Promise","resolve","reject","onFinally","then","slice","style","toString","unit","TypeError","Error","reg_percentage_test","cursor","target","event","rect","Rect","x","clientX","left","y","clientY","top","buildTestIntersectionFunction","amount","targetRect","intersection","getArea","Draggable","container","axis","exclude","delay","offset","resistance","handle","helper","revert","revertDuration","scrollSpeed","selector","tolerance","setHelperSize","grid","document","querySelector","WeakMap","onMouseDown","addEventListener","pageXOffset","pageYOffset","currentPosition","cancelMouseTracking","cancelTimer","closest","contains","Array","isArray","preventDefault","distanceBrokenPromise","isDistanceBroken","onMouseMove","calcDistance","removeEventListener","timerPromise","timer","setTimeout","clearTimeout","onMouseUp","all","timerStatus","distanceStatus","startDragging","offsetX","offsetY","startingX","startingY","cache","get","mousePosition","isDragging","set","cancel","scroller","dropTargets","startingClientRect","translate","width","height","pointerEvents","parentElement","appendChild","classList","refreshDropTargets","mouseX","mouseY","currentDropTargets","getDropTargets","dropTarget","indexOf","dispatchDropEvent","_moveElementToPosition","_selectElementRect","ScrollHelper","buildScrollHelper","publishDragMoveEvent","remove","accepted","isDefaultPrevented","reverted","publishDragDropEvent","isAccepted","accept","removeChild","setElementClientPosition","_revert","mousePos","testFunction","type","test","droppable","querySelectorAll","length","i","item","splice","Publisher","starting","self","startingRect","moveTo","right","bottom","Math","floor","fit","dragInstance","originalTarget","_getScrollParent","o","scrollWidth","clientWidth","scrollHeight","clientHeight","_getScrollRect","nodeName","innerWidth","innerHeight","scrollXSpeed","scrollYSpeed","frameID","scrollLeft","scrollTop","scrollParentRect","clamp","scrollParent","speed","getScrollSpeed","scrollRect","ScrollArea","scroll","getScroll","clone","opacity","className","zIndex","nodeType","cloneNode","name","originalEvent","currentRect","dispatch","publish","eventPackage","draggable","customEvent","createElement","box","getBoundingClientRect","boxSizing","items","dropOnEmpty","accepts","connect","initEvents","disconnect","hasDroppable","isOver","initialize","onDragMove","onDragComplete","onSortAppend","startBB","insertBefore","transform","matches","prototype","getItems","filter","before","getItemBeforePoint","after","getItemAfterPoint","beforeBB","dataset","_refreshPositions","_triggerSortAppendEvent","nextSibling","mx","my","getRelativePosition","current","deltaLeft","deltaTop","translation","getTranslation"],"mappings":"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","file":"chunk-0.bundle.js","sourcesContent":["import Sortable from \"core/ui/Sortable\";\r\n\r\n\r\nexport default class TestSortablePage {\r\n    load() {\r\n        window.sortableGrid = new Sortable(\"#sortable-grid\", {layout: 'xy', setPlaceholderSize: true});\r\n        window.sortableList1 = new Sortable('#drag-list-test', {droppables: '.drop-list', placeholder: true, setPlaceholderSize: true});\r\n        window.sortableList2 = new Sortable('#drag-list-test2', {droppables: '.drop-list', placeholder: true, setPlaceholderSize: true});\r\n    }\r\n}\r\n","import {EASING} from \"./easing\";\r\nimport FX from \"./FX\";\r\nimport {defaultApplyFrame} from \"./frame\";\r\n\r\n\r\nexport default class Animation {\r\n    static defaultApplyFrame = defaultApplyFrame;\r\n\r\n    static complete = FX.complete;\r\n    static canceled = FX.canceled;\r\n    static paused = FX.paused;\r\n    static pending = FX.pending;\r\n    static error = FX.error;\r\n    static playing = FX.playing;\r\n\r\n    /**\r\n     *\r\n     * @param duration\r\n     * @param frames {{}|function(Element element, Animation animation):{}}\r\n     * @param applyFrame - The function that takes a frame and applies it to the element.\r\n     * @param bubbleFrameEvent\r\n     * @param finishFrame\r\n     */\r\n    constructor({duration=null, frames, applyFrame = defaultApplyFrame, bubbleFrameEvent = false, finishFrame = null}) {\r\n        this.frames = frames;\r\n        this.applyFrame = applyFrame || Animation.defaultApplyFrame;\r\n        this.bubbleFrameEvent = bubbleFrameEvent;\r\n        this.finishFrame = finishFrame;\r\n        this.duration = duration;\r\n    }\r\n\r\n    /**\r\n     * Creates an fx object.\r\n     *\r\n     * @param element\r\n     * @param frames\r\n     * @param duration\r\n     * @param applyFrame\r\n     * @param easing\r\n     * @param onStart\r\n     * @param onFrame\r\n     * @param onPause\r\n     * @param onCancel\r\n     * @param onEnd\r\n     * @param onComplete\r\n     * @param bubbleFrameEvent\r\n     * @param finishFrame\r\n     * @returns {FX}\r\n     */\r\n    init({element, frames, duration, applyFrame, easing, onStart, onFrame, onPause, onCancel, onEnd, onComplete, bubbleFrameEvent, finishFrame}) {\r\n        return new FX(element, frames, duration, {\r\n            applyFrame,\r\n            easing,\r\n            animation: this,\r\n            onStart,\r\n            onFrame,\r\n            onPause,\r\n            onCancel,\r\n            onEnd,\r\n            onComplete,\r\n            bubbleFrameEvent,\r\n            finishFrame,\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Ran after the fx completes.\r\n     * @param fx\r\n     */\r\n    destroy(fx) {\r\n\r\n    }\r\n\r\n    /**\r\n     * Animates the given element.  Returns the FX object that can be used to control the animation.\r\n     *\r\n     * @param element {HTMLElement|Element} The element to animate.\r\n     * @param duration {Number} The duration of the animation in milliseconds.\r\n     * @param easing {function(Number)} An easing function that controls the rate of change for the animation.  If null linear animation is used.\r\n     * @param onStart {function(FX)} A callback function that is called right before the animation starts playing.\r\n     * @param onFrame {function(FX, frame)} A callback that is called per frame.\r\n     * @param onPause {function(FX)} A callback that is called when the FX pauses.\r\n     * @param onCancel {function(FX)} A callback that is called when the FX cancels.\r\n     * @param onEnd {function(FX)} A callback that is called when the animation ends.  Whether by completing, pausing, or canceling.  See Fx.status to determine what happened.\r\n     * @param onComplete {function(FX)} A callback that is called when the animation complete successfully.\r\n     * @param position\r\n     * @param autoPlay\r\n     * @returns {FX}\r\n     */\r\n    animate(element, {duration=null, easing = EASING.linear, onStart = null, onFrame = null, onPause = null, onCancel = null, onEnd = null, onComplete = null, position=0, autoPlay=true} = {}) {\r\n        if(duration === null) {\r\n            duration = this.duration;\r\n        }\r\n\r\n        let fx = this.init({\r\n            element: element,\r\n            frames: this.frames,\r\n            duration,\r\n            applyFrame: this.applyFrame,\r\n            easing,\r\n            animation: this,\r\n            onStart,\r\n            onFrame,\r\n            onPause,\r\n            onCancel,\r\n            onEnd: (fx) => {\r\n                if(onEnd) onEnd.call(fx, fx);\r\n                this.destroy(fx);\r\n            },\r\n            onComplete,\r\n            bubbleFrameEvent: this.bubbleFrameEvent,\r\n            finishFrame: this.finishFrame\r\n        });\r\n\r\n        if(position) {\r\n            fx.goto(position);\r\n        }\r\n\r\n        if(autoPlay) {\r\n            fx.play();\r\n        }\r\n        return fx;\r\n    }\r\n\r\n    goto(element, position) {\r\n        this.animate(element, {autoPlay: false, position: position});\r\n        return Animation.complete;\r\n    }\r\n\r\n    /**\r\n     * Creates a function that calls the animate method with the bound parameters.\r\n     * Parameters can be overridden in the created function when called.\r\n     * Method has the same signature as the animate method.\r\n     *\r\n     * Usage:\r\n     * let animation = new Animation(...),\r\n     *     fx = animation.bind(null, 2000);\r\n     *\r\n     * fx(element) // Animation the element over 2000 milliseconds.\r\n     *\r\n     * @param element\r\n     * @param config\r\n     * @returns {function(HTMLElement element, Number duration, Object config): FX}\r\n     */\r\n    bind(element = null, config = null) {\r\n        let defaults = {\r\n            element,\r\n            config\r\n        };\r\n\r\n        return (element = defaults, config=null) => {\r\n            element = element === defaults ? element.defaults : element;\r\n\r\n            let _options = {};\r\n            if (defaults.config) Object.assign(_options, defaults.config);\r\n            if (config) Object.assign(_options, config);\r\n\r\n            return this.animate(element, _options);\r\n        };\r\n    }\r\n}\r\n","import {ExtendableError} from \"../errors\";\r\nimport {selectElement} from \"../utility\";\r\nimport {RGBA} from \"../vectors\";\r\nimport {NumberWithUnit} from \"./types\";\r\nimport {EASING} from \"./easing\";\r\nimport {defaultApplyFrame} from \"./frame\";\r\n\r\n\r\nconst regNumberWithUnit = /^(\\d+\\.?\\d*)([a-z]+|%)$/i,\r\n    regColor = /^(?:#([a-f0-9]{3})|#([a-f0-9]{6})|#([a-f0-9]{8}))$/i,\r\n    regFunction = /^([a-z_][a-z_0-9]*)\\((.+?)\\)$/i;\r\n\r\n\r\nconst TYPE_FUNCTIONS = {\r\n    hex: RGBA.parseHexColorStringArg,\r\n    rgb: RGBA.parseRGBAColorStringArgs,\r\n    rgba: RGBA.parseRGBAColorStringArgs\r\n};\r\n\r\n\r\nexport class DeadFXError extends ExtendableError {}\r\n\r\n\r\nfunction assertFXAlive(fx) {\r\n    if (fx.status === FX.complete || fx.status === FX.error || fx.status === FX.complete) {\r\n        throw new DeadFXError(\"FX object is dead.\");\r\n    }\r\n}\r\n\r\n\r\nfunction doPromiseAction(onAction, value, resolveOrReject) {\r\n    if (typeof onAction === 'function') {\r\n        value = onAction(value);\r\n    }\r\n\r\n    resolveOrReject(value);\r\n}\r\n\r\n\r\nfunction _prepareValue(value) {\r\n    if (typeof value === 'string') {\r\n        value = value.trim();\r\n\r\n        let m = regNumberWithUnit.exec(value);\r\n\r\n        if (m) {\r\n            return new NumberWithUnit(parseFloat(m[1]), m[2]);\r\n        }\r\n\r\n        m = regColor.exec(value);\r\n\r\n        if (m) {\r\n            return TYPE_FUNCTIONS.hex(m[0]);\r\n        }\r\n\r\n        m = regFunction.exec(value);\r\n\r\n        if (m) {\r\n            return TYPE_FUNCTIONS[m[1]](m[2]);\r\n        }\r\n    }\r\n\r\n    return value;\r\n}\r\n\r\n\r\nfunction _getFrames(fx, element, frames) {\r\n    let r = {};\r\n\r\n    if (typeof frames === 'function') {\r\n        frames = frames.call(fx, element, fx);\r\n    }\r\n\r\n    for (let keyframeIndex in frames) {\r\n        if (!frames.hasOwnProperty(keyframeIndex)) continue;\r\n\r\n        let frame = frames[keyframeIndex];\r\n        r[keyframeIndex] = {};\r\n\r\n        for (let property in frame) {\r\n            if (!frame.hasOwnProperty(property)) continue;\r\n            r[keyframeIndex][property] = _prepareValue(frame[property]);\r\n        }\r\n    }\r\n\r\n    return r;\r\n}\r\n\r\n\r\n/**\r\n * @implements Promise\r\n */\r\nexport default class FX {\r\n    static pending = \"Pending\";\r\n    static complete = \"Complete\";\r\n    static error = \"Error\";\r\n    static paused = \"Paused\";\r\n    static canceled = \"Canceled\";\r\n    static playing = \"Playing\";\r\n\r\n    #element;\r\n    #chained;\r\n    #frames;\r\n    #internalValue;\r\n\r\n    #animation;\r\n\r\n    #frameId;\r\n    #status;\r\n    #position;\r\n\r\n    #finishFrame;\r\n    #applyFrame;\r\n    #easing;\r\n    #duration;\r\n\r\n    [Symbol.toStringTag] = \"[Object FX]\";\r\n\r\n    constructor(element, frames, duration, {applyFrame = defaultApplyFrame, animation = null, easing = EASING.linear, onComplete = null, onCancel = null, onFrame = null, onStart = null, onEnd = null, bubbleFrameEvent = false, finishFrame = null, init = null} = {}) {\r\n        this.#frames = [];\r\n        this.#chained = [];\r\n        this.#element = selectElement(element);\r\n        this.#internalValue = undefined;\r\n\r\n        this.onComplete = onComplete;\r\n        this.onCancel = onCancel;\r\n        this.onFrame = onFrame;\r\n        this.onStart = onStart;\r\n        this.onEnd = onEnd;\r\n        this.bubbleFrameEvent = bubbleFrameEvent;\r\n\r\n        this.#animation = animation;\r\n        this.#finishFrame = finishFrame;\r\n        this.#applyFrame = applyFrame;\r\n        this.#easing = easing;\r\n        this.#frameId = null;\r\n        this.#status = FX.pending;\r\n\r\n        this.#duration = duration;\r\n        this.#position = 0;\r\n\r\n        if (init) {\r\n            init.call(this, this);\r\n        }\r\n\r\n        // Prepare frames\r\n        frames = _getFrames(this, this.#element, frames);\r\n\r\n        for (let key in frames) {\r\n            if (frames.hasOwnProperty(key)) {\r\n                let frame = frames[key],\r\n                    pos = parseFloat(key) / 100;\r\n\r\n                if (typeof frame === 'function') {\r\n                    frame = frame.call(this, this.#element);\r\n                }\r\n\r\n                frame = Object.freeze(Object.assign({}, frame));\r\n\r\n                this.#frames.push(Object.freeze({\r\n                    position: pos,\r\n                    properties: frame\r\n                }));\r\n            }\r\n        }\r\n\r\n        this.#frames.sort((a, b) => a.position - b.pos);\r\n    }\r\n\r\n    get animation() {\r\n        return this.#animation;\r\n    }\r\n\r\n    // noinspection JSUnusedGlobalSymbols\r\n    get easing() {\r\n        return this.#easing;\r\n    }\r\n\r\n    get status() {\r\n        return this.#status;\r\n    }\r\n\r\n    get position() {\r\n        return this.#position;\r\n    }\r\n\r\n    // noinspection JSUnusedGlobalSymbols\r\n    get duration() {\r\n        return this.#duration;\r\n    }\r\n\r\n    // noinspection JSUnusedGlobalSymbols\r\n    get frames() {\r\n        return this.#frames.slice();\r\n    }\r\n\r\n    get element() {\r\n        return this.#element;\r\n    }\r\n\r\n    // set position(value) {\r\n    //     if (typeof value === 'string') {\r\n    //         value = (parseFloat(value) / 100) * this.#duration;\r\n    //     }\r\n    //\r\n    //     this.#position = Math.max(0.0, Math.min(this.#duration, value));\r\n    // }\r\n\r\n    get state() {\r\n        if (this.status === FX.complete || this.status === FX.canceled) {\r\n            return \"Fulfilled\";\r\n        } else if (this.status === FX.error) {\r\n            return \"Rejected\";\r\n        } else {\r\n            return \"Pending\";\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Returns the frame options at the given position.\r\n     * @param position\r\n     */\r\n    getFrameFX(position) {\r\n        // position can either be a percentage string (aka 50%) or the time in milliseconds into the animation\r\n        // which will be converted into a percentage.\r\n        if (typeof position === 'string') {\r\n            position = parseFloat(position) / 100;\r\n        }\r\n\r\n        // At this point position should be a value between 0.0 and 1.0.\r\n        // Easing functions specify that rate of change in the properties.\r\n        // It takes the position and maps it to another value between 0.0f and 1.0f.\r\n        // By default linear easing is used.\r\n        if (this.#easing) {\r\n            position = this.#easing(position);\r\n        }\r\n\r\n        let r = {};\r\n\r\n        for (let frame of this.#frames) {\r\n            for (let key in frame.properties) {\r\n                if (frame.properties.hasOwnProperty(key)) {\r\n                    let value = frame.properties[key];\r\n\r\n                    if (!r[key]) {\r\n                        r[key] = {startPosition: null, startValue: null, endPosition: null, endValue: null};\r\n                    }\r\n\r\n                    if (frame.position <= position) {\r\n                        r[key].startPosition = frame.position;\r\n                        r[key].startValue = value;\r\n                    } else if (frame.position > position && r[key].endPosition === null) {\r\n                        r[key].endPosition = frame.position;\r\n                        r[key].endValue = value;\r\n                    }\r\n                }\r\n            }\r\n        }\r\n\r\n        return r;\r\n    }\r\n\r\n    /**\r\n     * Returns the final frame at the given position.  All options at this point should be parsed and there final values\r\n     * should be available.\r\n     *\r\n     * @param position\r\n     */\r\n    getFrame(position) {\r\n        let frame = this.getFrameFX(position),\r\n            r = {};\r\n\r\n        if (typeof position === 'string') {\r\n            position = parseFloat(position) / 100;\r\n        }\r\n\r\n        // Takes the frame config options and calculates the final values.\r\n        for (let property in frame) {\r\n            if (frame.hasOwnProperty(property)) {\r\n                let options = frame[property];\r\n\r\n                if ((options.endPosition === null || options.endPosition <= position) && options.startValue !== null) {\r\n                    r[property] = options.startValue;\r\n                } else if (options.startValue !== null) {\r\n                    if (typeof options.startValue === 'object') {\r\n                        let p = (position - options.startPosition) / (options.endPosition - options.startPosition),\r\n                            delta = options.endValue.subtract(options.startValue);\r\n\r\n                        r[property] = options.startValue.add(delta.scalar(p));\r\n                    } else if (typeof options.startValue === 'number') {\r\n                        let duration = (options.endPosition - options.startPosition),\r\n                            p = (position - options.startPosition) / duration,\r\n                            delta = options.endValue - options.startValue;\r\n\r\n                        r[property] = options.startValue + (delta * p);\r\n                    } else {\r\n                        r[property] = options.startValue;\r\n                    }\r\n                }\r\n            }\r\n        }\r\n\r\n        // User provided hook that can perform the final touch ups on the frame.\r\n        if (this.#finishFrame) {\r\n            r = this.#finishFrame(this, frame);\r\n        }\r\n\r\n        return r;\r\n    }\r\n\r\n    play() {\r\n        assertFXAlive(this);\r\n\r\n        if (this.#frameId === null) {\r\n            this.goto(this.#position);\r\n\r\n            let tick = performance.now();\r\n\r\n            let frameFN = () => {\r\n                let timestamp = performance.now(),\r\n                    delta = timestamp - tick,\r\n                    position = this.#position + (delta / this.duration);\r\n\r\n                tick = timestamp;\r\n                let frame = this.goto(position);\r\n                this.#status = FX.playing;\r\n\r\n                if (this.onFrame) this.onFrame.call(this, this, frame);\r\n\r\n                this.#element.dispatchEvent(new CustomEvent('animation.frame', {\r\n                    bubbles: this.bubbleFrameEvent,\r\n                    detail: this\r\n                }));\r\n\r\n                if (this.#position < 1) {\r\n                    this.#frameId = window.requestAnimationFrame(frameFN);\r\n                } else {\r\n                    this._complete(FX.complete, FX.complete);\r\n                    this.#frameId = null;\r\n                }\r\n            };\r\n\r\n            if (this.onStart) {\r\n                this.onStart.call(this, this);\r\n            }\r\n\r\n            this.#element.dispatchEvent(new CustomEvent('animation.start', {\r\n                bubbles: true,\r\n                detail: this\r\n            }));\r\n\r\n            this.#frameId = window.requestAnimationFrame(frameFN);\r\n        }\r\n\r\n        return this;\r\n    }\r\n\r\n    // noinspection JSUnusedGlobalSymbols\r\n    /**\r\n     * Pauses the animation.  Does not resolve it.\r\n     * @returns {FX}\r\n     */\r\n    pause() {\r\n        if (this.#frameId) {\r\n            window.cancelAnimationFrame(this.#frameId);\r\n            this.#frameId = null;\r\n            this.#status = FX.paused;\r\n\r\n            this.#element.dispatchEvent(new CustomEvent('animation.paused', {\r\n                bubbles: true,\r\n                detail: this\r\n            }));\r\n        }\r\n\r\n        return this;\r\n    }\r\n\r\n    _cancel(complete = false, status = FX.canceled) {\r\n        if (this.#frameId) {\r\n            window.cancelAnimationFrame(this.#frameId);\r\n            this.#frameId = null;\r\n\r\n            if (complete) {\r\n                this.goto(1);\r\n                this._complete(status, status);\r\n            } else {\r\n                this.#status = status;\r\n                this.#internalValue = status;\r\n            }\r\n\r\n            if (this.onCancel) this.onCancel.call(this, this);\r\n\r\n            this.#element.dispatchEvent(new CustomEvent('animation.canceled', {\r\n                bubbles: true,\r\n                detail: this\r\n            }));\r\n\r\n            this._triggerEndEvent();\r\n        }\r\n\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * Cancel the animation with the canceled state.   optionally sets the animation to it's final frame if\r\n     * completeAnimation is true.\r\n     *\r\n     * @param completeAnimation\r\n     * @returns {FX}\r\n     */\r\n    cancel(completeAnimation = false) {\r\n        return this._cancel(completeAnimation, FX.canceled);\r\n    }\r\n\r\n    /**\r\n     * Completes the animation immediately and sets is status to complete.\r\n     * @returns {FX}\r\n     */\r\n    complete() {\r\n        return this._cancel(true, FX.complete);\r\n    }\r\n\r\n    goto(position) {\r\n        assertFXAlive(this);\r\n\r\n        if (typeof position === 'string') {\r\n            position = parseFloat(position) / 100;\r\n        }\r\n\r\n        this.#position = position;\r\n        return this.applyFrame(this.position);\r\n    }\r\n\r\n    applyFrame(position) {\r\n        let frame = this.getFrame(position);\r\n        this.#applyFrame.call(this, this, frame);\r\n        return frame;\r\n    }\r\n\r\n    _triggerEndEvent() {\r\n        if (this.onEnd) this.onEnd.call(this, this);\r\n\r\n        this.#element.dispatchEvent(new CustomEvent('animation.end', {\r\n            bubbles: true,\r\n            detail: this\r\n        }));\r\n\r\n        for (let {onResolve} of this.#chained) {\r\n            if (onResolve) onResolve(this.#internalValue);\r\n        }\r\n        this.#chained = [];\r\n    }\r\n\r\n    _complete(value, status = FX.complete) {\r\n        if (this.state !== \"Pending\") {\r\n            return;\r\n        }\r\n\r\n        this.#status = status;\r\n        this.#internalValue = value;\r\n\r\n        if (this.onComplete) this.onComplete.call(this, this);\r\n\r\n        this.#element.dispatchEvent(new CustomEvent('animation.complete', {\r\n            bubbles: true,\r\n            detail: this\r\n        }));\r\n\r\n        this._triggerEndEvent();\r\n    }\r\n\r\n    then(onResolve, onReject) {\r\n        if (this.state === \"Pending\") {\r\n            return new Promise((resolve, reject) => {\r\n                // noinspection JSUnusedGlobalSymbols\r\n                this.#chained.push({\r\n                    onResolve: (value) => {\r\n                        doPromiseAction(onResolve, value, resolve);\r\n                    },\r\n\r\n                    onReject: (value) => {\r\n                        doPromiseAction(onReject, value, reject);\r\n                    }\r\n                });\r\n            });\r\n        } else if (this.state === 'Fulfilled' && typeof onResolve === 'function') {\r\n            return new Promise((resolve) => {\r\n                doPromiseAction(onResolve, this.#internalValue, resolve);\r\n            });\r\n        } else if (this.state === 'Rejected' && typeof onReject === 'function') {\r\n            return new Promise((resolve, reject) => {\r\n                doPromiseAction(onReject, this.#internalValue, reject);\r\n            });\r\n        }\r\n    }\r\n\r\n    // noinspection JSUnusedGlobalSymbols\r\n    finally(onFinally) {\r\n        onFinally = (value) => {\r\n            if (typeof onFinally === 'function') {\r\n                onFinally();\r\n            }\r\n\r\n            return value;\r\n        };\r\n\r\n        return this.then(onFinally, onFinally);\r\n    }\r\n\r\n    // noinspection JSUnusedGlobalSymbols\r\n    catch(onReject) {\r\n        return this.then(undefined, onReject);\r\n    }\r\n}\r\n","/**\r\n *\r\n * @param p\r\n * @returns {*}\r\n */\r\nexport function linear(p) {\r\n    return p;\r\n}\r\n\r\n\r\n// noinspection JSUnusedGlobalSymbols\r\nexport const EASING = {\r\n    linear: linear\r\n};\r\n","export function defaultApplyFrame(fx, frame) {\r\n    for (let key in frame) {\r\n        if (frame.hasOwnProperty(key)) {\r\n            fx.element.style[key] = frame[key].toString();\r\n        }\r\n    }\r\n}\r\n","export class NumberWithUnit {\r\n    constructor(value, unit) {\r\n        this.value = value;\r\n        this.unit = unit;\r\n    }\r\n\r\n    add(value) {\r\n        if (typeof value !== \"number\") {\r\n            if (!(value instanceof NumberWithUnit)) {\r\n                throw new TypeError(\"Cannot perform action on invalid type.\");\r\n            }\r\n\r\n            if (this.unit !== value.unit) {\r\n                throw new Error(\"Mismatched units\");\r\n            }\r\n\r\n            value = value.value;\r\n        }\r\n\r\n\r\n        return new NumberWithUnit(this.value + value, this.unit);\r\n    }\r\n\r\n    subtract(value) {\r\n        if (typeof value !== \"number\") {\r\n            if (!(value instanceof NumberWithUnit)) {\r\n                throw new TypeError(\"Cannot perform action on invalid type.\");\r\n            }\r\n\r\n            if (this.unit !== value.unit) {\r\n                throw new Error(\"Mismatched units\");\r\n            }\r\n\r\n            value = value.value;\r\n        }\r\n\r\n        return new NumberWithUnit(this.value - value, this.unit);\r\n    }\r\n\r\n    scalar(value) {\r\n        if (typeof value !== \"number\") {\r\n            if (!(value instanceof NumberWithUnit)) {\r\n                throw new TypeError(\"Cannot perform action on invalid type.\");\r\n            }\r\n\r\n            if (this.unit !== value.unit) {\r\n                throw new Error(\"Mismatched units\");\r\n            }\r\n\r\n            value = value.value;\r\n        }\r\n\r\n        return new NumberWithUnit(this.value * value, this.unit);\r\n    }\r\n\r\n    // noinspection JSUnusedGlobalSymbols\r\n    divide(value) {\r\n        if (typeof value !== \"number\") {\r\n            if (!(value instanceof NumberWithUnit)) {\r\n                throw new TypeError(\"Cannot perform action on invalid type.\");\r\n            }\r\n\r\n            if (this.unit !== value.unit) {\r\n                throw new Error(\"Mismatched units\");\r\n            }\r\n\r\n            value = value.value;\r\n        }\r\n\r\n        return new NumberWithUnit(this.value / value, this.unit);\r\n    }\r\n\r\n    toString() {\r\n        return `${this.value}${this.unit}`;\r\n    }\r\n}\r\n","import Publisher from \"../Publisher\";\r\nimport {calcDistance, clamp} from \"../utility\";\r\nimport Rect from \"../vectors/Rect\";\r\nimport {getScroll} from \"../utility\";\r\nimport {setElementClientPosition} from \"./position\";\r\nimport Animation from \"../fx/Animation\";\r\n\r\n\r\nconst reg_percentage_test = /\\s*\\d+\\.?\\d*%\\s*/;\r\n\r\n\r\n/**\r\n * Returns the offset position of the mouse relative to the target.\r\n *\r\n * @param target\r\n * @param event\r\n * @returns {{x: number, y: number}}\r\n */\r\nexport function cursor(target, event) {\r\n    let rect = new Rect(target);\r\n\r\n    return {\r\n        x: event.clientX - rect.left,\r\n        y: event.clientY - rect.top\r\n    };\r\n}\r\n\r\n\r\nfunction buildTestIntersectionFunction(amount) {\r\n    return function(element, rect) {\r\n        rect = new Rect(rect);\r\n\r\n        let targetRect = new Rect(element),\r\n            intersection = targetRect.intersection(rect),\r\n            p = intersection ? intersection.getArea() / rect.getArea() : 0;\r\n\r\n        return p > amount;\r\n    }\r\n}\r\n\r\n\r\nexport default class Draggable extends Publisher {\r\n    #element;\r\n    #droppables;\r\n    #boundOnMouseDown;\r\n    #itemCache;\r\n\r\n    constructor(element, {container=null, axis='xy', exclude='', delay=0, offset=cursor,\r\n        resistance=0, handle=null, helper=null, revert=false, revertDuration=0,\r\n        scrollSpeed=0, selector=null, tolerance=0.5, setHelperSize=false, grid=null}={}) {\r\n        super();\r\n\r\n        if(typeof element === 'string') {\r\n            this.#element = document.querySelector(element);\r\n        } else {\r\n            this.#element = element;\r\n        }\r\n\r\n        this.#droppables = [];\r\n        this.#itemCache = new WeakMap();\r\n\r\n        this.container = container;\r\n        this.axis = axis;\r\n        this.exclude = exclude;\r\n        this.delay = delay;\r\n        this.offset = offset;\r\n        this.resistance = resistance;\r\n        this.handle = handle;\r\n        this.helper = helper;\r\n        this.revert = revert;\r\n        this.revertDuration = revertDuration;\r\n        this.scrollSpeed = scrollSpeed;\r\n        this.selector = selector;\r\n        this.tolerance = tolerance;\r\n        this.setHelperSize = setHelperSize;\r\n        this.grid = grid;\r\n\r\n        if(typeof this.container === 'string') {\r\n            this.container = document.querySelector(this.container);\r\n        }\r\n\r\n        this.#boundOnMouseDown = event => {\r\n            return this.onMouseDown(event);\r\n        };\r\n\r\n        this.element.addEventListener('mousedown', this.#boundOnMouseDown);\r\n    }\r\n\r\n    /**\r\n     * Starts dragging if the correct elements have been targeted and delay and resistance have been meet.\r\n     *\r\n     * @param event\r\n     * @returns {Promise<void>}\r\n     */\r\n    async onMouseDown(event) {\r\n        let startPosition = {x: event.clientX + window.pageXOffset, y: event.clientY + window.pageYOffset},\r\n            currentPosition = {x: startPosition.x, y: startPosition.y},\r\n            target = this.#element,\r\n            cancelMouseTracking = null,\r\n            cancelTimer = null,\r\n            distanceBrokenPromise,\r\n            timerPromise,\r\n            offset;\r\n\r\n        // Only start dragging if a draggable child of the element is targeted.\r\n        // If selector is null then the entire element is draggable and should be the target.\r\n        if(this.selector) {\r\n            target = event.target.closest(this.selector);\r\n\r\n            if(!target || !this.#element.contains(target)) {\r\n                return;\r\n            }\r\n        }\r\n\r\n        // Only start dragging if the handle was targeted.\r\n        // If handle is null then the entire target is the handle.\r\n        if(this.handle) {\r\n            let handle = event.target.closest(this.handle);\r\n\r\n            if(!handle || !target.contains(handle)) {\r\n                return;\r\n            }\r\n        }\r\n\r\n        // If any excluded elements are targeted ignore the event.\r\n        if(this.exclude) {\r\n            let exclude = event.target.closest(this.exclude);\r\n\r\n            if(exclude && target.contains(exclude)) {\r\n                return;\r\n            }\r\n        }\r\n\r\n        // Find the offset of the event.\r\n        if(typeof this.offset === 'function') {\r\n            offset = this.offset(target, event);\r\n        } else if(Array.isArray(this.offset)) {\r\n            offset = {\r\n                x: this.offset[0],\r\n                y: this.offset[1]\r\n            };\r\n        } else if(typeof this.offset === 'object') {\r\n            offset = {\r\n                x: this.offset.x,\r\n                y: this.offset.y\r\n            };\r\n        } else {\r\n            offset = {x: 0, y: 0};\r\n        }\r\n\r\n        // Prevent default browser actions.\r\n        event.preventDefault();\r\n\r\n        // At this point we can be sure that a draggable item was\r\n        // targeted by it's handle and no excluded items where clicked.\r\n\r\n        // Creates a promise that both tracks the current mouse coords and resolve\r\n        // when the user passes the given resistance.\r\n        distanceBrokenPromise = new Promise(resolve => {\r\n            let isDistanceBroken = this.resistance <= 0;\r\n\r\n            if(isDistanceBroken) {\r\n                resolve('complete');\r\n            }\r\n\r\n            let onMouseMove = event => {\r\n                currentPosition.x = event.clientX + window.pageXOffset;\r\n                currentPosition.y = event.clientY + window.pageYOffset;\r\n                event.preventDefault();\r\n\r\n                if(!isDistanceBroken && calcDistance(currentPosition.x, currentPosition.y, startPosition.x, startPosition.y) > this.resistance) {\r\n                    resolve('complete');\r\n                    isDistanceBroken = true;\r\n                }\r\n            };\r\n\r\n            // Cancel mouse tracking and resolve the promise to canceled if hasn't already been resolve.\r\n            // This function must be called or their will be a memory leak before onMouseDown completes.\r\n            cancelMouseTracking = () => {\r\n                if(onMouseMove) {\r\n                    document.removeEventListener('mousemove', onMouseMove);\r\n\r\n                    if(!isDistanceBroken) {\r\n                        resolve('canceled');\r\n                    }\r\n\r\n                    onMouseMove = null;\r\n                }\r\n            };\r\n\r\n            document.addEventListener('mousemove', onMouseMove);\r\n        });\r\n\r\n        // Creates a promise that resolve when after the delay time passes or the user cancels the drag by\r\n        // releasing the mouse button.\r\n        timerPromise = new Promise(resolve => {\r\n            let timer = null;\r\n\r\n            if(this.delay >= 0) {\r\n                timer = setTimeout(() => {\r\n                    resolve(\"complete\");\r\n                    timer = null;\r\n                }, this.delay);\r\n            } else {\r\n                resolve('complete');\r\n            }\r\n\r\n            // cancel the timer and resolve it to canceled if it is still active.\r\n            cancelTimer = () => {\r\n                if(timer) {\r\n                    clearTimeout(timer);\r\n                    resolve('canceled');\r\n                }\r\n            };\r\n        });\r\n\r\n        // cancel the timer and mouse tracking if they are still active.\r\n        let onMouseUp = event => {\r\n            event.preventDefault();\r\n            cancelTimer();\r\n            cancelMouseTracking();\r\n            document.removeEventListener('mouseup', onMouseUp);\r\n        };\r\n\r\n        document.addEventListener('mouseup', onMouseUp);\r\n\r\n        // Wait until the delay time and distance have passed or failed.\r\n        let [timerStatus, distanceStatus] = await Promise.all([timerPromise, distanceBrokenPromise]);\r\n\r\n        // Ensure that mouse tracking has been canceled.\r\n        if(cancelMouseTracking) cancelMouseTracking();\r\n\r\n        // At this point both the timer and distance status should have passed or failed.\r\n        // If either failed do nothing.\r\n        if(timerStatus === 'complete' && distanceStatus === 'complete') {\r\n            this.startDragging(target, {\r\n                offsetX: offset.x,\r\n                offsetY: offset.y,\r\n                // Make relative to client.\r\n                startingX: currentPosition.x,\r\n                startingY: currentPosition.y\r\n            });\r\n        }\r\n    }\r\n\r\n    async startDragging(element, pos) {\r\n        let cache = this.#itemCache.get(element),\r\n            mousePosition = {x: pos.startingX, y: pos.startingY};\r\n\r\n        if(!cache) {\r\n            cache = {isDragging: false, fx: null, rect: null, helper: null, element: element};\r\n            this.#itemCache.set(element, cache);\r\n        }\r\n\r\n        if(cache.isDragging) {\r\n            return;\r\n        }\r\n\r\n        cache.isDragging = true;\r\n\r\n        if(cache.fx) {\r\n            await cache.fx.cancel();\r\n            cache.fx = null;\r\n        }\r\n\r\n        let target = element,\r\n            container = this.container,\r\n            scroller = null,\r\n            dropTargets = [],\r\n            startPosition = new Rect(element),\r\n            startingClientRect = startPosition;\r\n\r\n        startPosition = startPosition.translate(\r\n            window.pageXOffset,\r\n            window.pageYOffset\r\n        );\r\n\r\n        if(!cache.rect) {\r\n            cache.rect = startPosition;\r\n        }\r\n\r\n        if(typeof container === 'string') {\r\n            container = document.querySelector(container);\r\n        }\r\n\r\n        if(this.helper) {\r\n            if(typeof this.helper === 'function') {\r\n                target = this.helper(element);\r\n            } else {\r\n                target = this.helper;\r\n            }\r\n\r\n            if(this.setHelperSize) {\r\n                target.style.width = startPosition.width + \"px\";\r\n                target.style.height = startPosition.height + \"px\";\r\n            }\r\n\r\n            target.style.pointerEvents = 'none';\r\n\r\n            if(!target.parentElement && element.parentElement) {\r\n                element.parentElement.appendChild(target);\r\n            }\r\n\r\n            target.classList.add('ui-drag-helper');\r\n\r\n            cache.helper = target;\r\n        }\r\n\r\n        let refreshDropTargets = (rect) => {\r\n            // drag-enter\r\n            let mouseX = mousePosition.x - window.pageXOffset,\r\n                mouseY = mousePosition.y - window.pageYOffset,\r\n                currentDropTargets,\r\n                detail = {clientX: mouseX, clientY: mouseY};\r\n\r\n            if(rect !== null) {\r\n                currentDropTargets = this.getDropTargets(rect, {mouseX, mouseY});\r\n            } else {\r\n                currentDropTargets = [];\r\n            }\r\n\r\n            for(let dropTarget of currentDropTargets) {\r\n                if(dropTargets.indexOf(dropTarget) === -1) {\r\n                    dispatchDropEvent(this, 'drag.enter', element, target, null, rect, true, true, false, detail, dropTarget);\r\n                }\r\n            }\r\n\r\n            for(let dropTarget of dropTargets) {\r\n                if(currentDropTargets.indexOf(dropTarget) === -1) {\r\n                    dispatchDropEvent(this, 'drag.leave', element, target, null, rect, true, true, false, detail, dropTarget);\r\n                }\r\n            }\r\n\r\n            // drag-leave\r\n            dropTargets = currentDropTargets;\r\n        };\r\n\r\n        let onMouseMove = event => {\r\n            event.preventDefault();\r\n            let rect = _moveElementToPosition(this, target, event.clientX, event.clientY, pos.offsetX, pos.offsetY, _selectElementRect(container, this, target, element));\r\n\r\n            mousePosition.x = event.clientX + window.pageXOffset;\r\n            mousePosition.y = event.clientY + window.pageYOffset;\r\n\r\n            if(this.scrollSpeed > 0) {\r\n                if(scroller) {\r\n                    scroller.cancel();\r\n                    scroller = null;\r\n                }\r\n\r\n                scroller = ScrollHelper.buildScrollHelper(element, target, rect, pos, this, event, this.scrollSpeed, container);\r\n            }\r\n\r\n            refreshDropTargets(rect);\r\n\r\n            publishDragMoveEvent(this, element, target, event, rect);\r\n        };\r\n\r\n        let onMouseUp = async event => {\r\n            event.preventDefault();\r\n            document.removeEventListener('mousemove', onMouseMove);\r\n            document.removeEventListener('mouseup', onMouseUp);\r\n            cache.isDragging = false;\r\n            element.classList.remove('ui-dragging');\r\n\r\n            if(scroller) {\r\n                scroller.cancel();\r\n                scroller = null;\r\n            }\r\n\r\n            let accepted = false,\r\n                isDefaultPrevented = false,\r\n                reverted = false,\r\n                rect = new Rect(target);\r\n\r\n            publishDragDropEvent(this, element, target, event, rect, false, {\r\n                isDefaultPrevented() {\r\n                    return isDefaultPrevented;\r\n                },\r\n\r\n                isAccepted() {\r\n                    return accepted;\r\n                },\r\n\r\n                accept() {\r\n                    accepted = true;\r\n                },\r\n\r\n                preventDefault() {\r\n                    isDefaultPrevented = true;\r\n                }\r\n            });\r\n\r\n            if(this.revert && !accepted) {\r\n                refreshDropTargets(cache.rect);\r\n                rect = cache.rect;\r\n\r\n                if(!this.revertDuration) {\r\n                    if(target !== element) {\r\n                        target.parentElement.removeChild(target);\r\n                    } else {\r\n                        let pos = startPosition.translate(\r\n                            -window.pageXOffset,\r\n                            -window.pageYOffset\r\n                        );\r\n\r\n                        setElementClientPosition(target, pos, 'translate3d');\r\n                    }\r\n                } else {\r\n                    cache.fx = _revert(target, cache.rect, this.revertDuration);\r\n\r\n                    await cache.fx;\r\n\r\n                    if(target !== element) {\r\n                        target.parentElement.removeChild(target);\r\n                    }\r\n                }\r\n\r\n                reverted = true;\r\n            } else {\r\n                if(target !== element) {\r\n                    target.parentElement.removeChild(target);\r\n                    setElementClientPosition(element, rect, 'translate3d');\r\n                }\r\n            }\r\n\r\n            this.#itemCache.delete(element);\r\n\r\n            dispatchDropEvent(this, 'drag.end', element, target, event, rect, true, true, true, {accepted, reverted}, element);\r\n        };\r\n\r\n        // Set target to starting position.\r\n        if(mousePosition.x !== undefined && mousePosition.y !== undefined) {\r\n            let rect = _moveElementToPosition(this, target, mousePosition.x - window.pageXOffset, mousePosition.y - window.pageYOffset, pos.offsetX, pos.offsetY, _selectElementRect(container, this, target, element));\r\n            refreshDropTargets(rect);\r\n        }\r\n\r\n        document.addEventListener('mousemove', onMouseMove);\r\n        document.addEventListener('mouseup', onMouseUp);\r\n        element.classList.add('ui-dragging');\r\n\r\n        dispatchDropEvent(this, 'drag.start', element, target, null, startingClientRect, true, true, true, null);\r\n    }\r\n\r\n    getDropTargets(rect, mousePos) {\r\n        let r = [];\r\n\r\n        /**\r\n         * @type {number|String|Function|string}\r\n         */\r\n        let testFunction = this.tolerance,\r\n            type = typeof testFunction;\r\n\r\n        if(type === 'string') {\r\n            // noinspection JSCheckFunctionSignatures\r\n            if(reg_percentage_test.test(testFunction)) {\r\n                // noinspection JSCheckFunctionSignatures\r\n                testFunction = buildTestIntersectionFunction(parseFloat(testFunction) / 100);\r\n            }\r\n        } else if(type === 'number') {\r\n            testFunction = buildTestIntersectionFunction(testFunction);\r\n        }\r\n\r\n        for(let droppable of this.#droppables) {\r\n            if(testFunction(droppable, rect, mousePos, this)) {\r\n                r.push(droppable);\r\n            }\r\n        }\r\n\r\n        return r;\r\n    }\r\n\r\n    connect(droppables) {\r\n        if(typeof droppables === 'string') {\r\n            droppables = document.querySelectorAll(droppables);\r\n        } else if(typeof droppables.length !== 'number') {\r\n            droppables = [droppables];\r\n        }\r\n\r\n        for(let i = 0; i < droppables.length; i++) {\r\n            let item = droppables[i];\r\n\r\n            if(this.#droppables.indexOf(item) === -1) {\r\n                this.#droppables.push(item);\r\n            }\r\n        }\r\n    }\r\n\r\n    // noinspection JSUnusedGlobalSymbols\r\n    disconnect(droppable) {\r\n        if(typeof droppable === 'string') {\r\n            droppable = document.querySelector(droppable);\r\n        }\r\n\r\n        let i = this.#droppables.indexOf(droppable);\r\n\r\n        if(i !== -1) {\r\n            this.#droppables.splice(i, 1);\r\n        }\r\n    }\r\n\r\n    // noinspection JSUnusedGlobalSymbols\r\n    hasDroppable(droppable) {\r\n        if(typeof droppable === 'string') {\r\n            droppable = document.querySelector(droppable);\r\n        }\r\n\r\n        return this.#droppables.indexOf(droppable) !== -1;\r\n    }\r\n\r\n    // noinspection JSUnusedGlobalSymbols\r\n    get droppables() {\r\n        return this.#droppables.slice(0);\r\n    }\r\n\r\n    get element() {\r\n        return this.#element;\r\n    }\r\n}\r\n\r\n\r\nfunction _revert(target, position, revertDuration, onFrame=null) {\r\n    let starting = new Rect(target);\r\n\r\n    let animation = new Animation({\r\n        frames: {\r\n            '0%': {\r\n                left: starting.left + window.pageXOffset,\r\n                top: starting.top + window.pageYOffset\r\n            },\r\n\r\n            '100%': {\r\n                left: position.left,\r\n                top: position.top\r\n            }\r\n        },\r\n\r\n        applyFrame(fx, frame) {\r\n            setElementClientPosition(fx.element, {\r\n                left: frame.left - window.pageXOffset,\r\n                top: frame.top - window.pageYOffset\r\n            }, 'translate3d');\r\n\r\n            if(onFrame) onFrame(fx);\r\n        }\r\n    });\r\n\r\n    return animation.animate(target, {duration: revertDuration});\r\n}\r\n\r\n\r\n/**\r\n * Takes a client (x, y) position and some offset coords and move the element to the given position.\r\n *\r\n * @param self\r\n * @param element\r\n * @param x\r\n * @param y\r\n * @param offsetX\r\n * @param offsetY\r\n * @param container\r\n * @private\r\n * @returns {*|Rect}\r\n */\r\nfunction _moveElementToPosition(self, element, x, y, offsetX, offsetY, container) {\r\n    let rect = new Rect(element),\r\n        startingRect = rect;\r\n\r\n    rect = rect.moveTo({left: x, top: y});\r\n\r\n    offsetX = offsetX || 0;\r\n    offsetY = offsetY || 0;\r\n\r\n    rect = rect.translate(-offsetX, -offsetY);\r\n\r\n    if(self.axis === 'y') {\r\n        rect = new Rect(\r\n            startingRect.left,\r\n            rect.top,\r\n            startingRect.right,\r\n            rect.bottom\r\n        );\r\n    } else if(self.axis === 'x') {\r\n        rect = new Rect(\r\n            rect.left,\r\n            startingRect.top,\r\n            rect.right,\r\n            startingRect.bottom\r\n        );\r\n    }\r\n\r\n    if(typeof self.grid === 'number' && self.grid) {\r\n        let left = Math.floor(rect.left / self.grid) * self.grid,\r\n            top = Math.floor(rect.top / self.grid) * self.grid;\r\n\r\n        rect = new Rect(left, top, left + startingRect.width, top + startingRect.height);\r\n    }\r\n\r\n    if(container) {\r\n        container = new Rect(container);\r\n        rect = rect.fit(container);\r\n    }\r\n\r\n    setElementClientPosition(element, rect, 'translate3d');\r\n    return rect;\r\n}\r\n\r\n\r\n// noinspection JSCommentMatchesSignature\r\n/**\r\n * For module use only.  Selects the element either by css selector, if it's a string, or resolve a function.\r\n * If the element is already element is is returned direction.  Returns null if not element is provided.\r\n *\r\n * @param element\r\n * @param dragInstance\r\n * @param target\r\n * @returns {null|*}\r\n * @private\r\n */\r\nfunction _selectElementRect(element, dragInstance, target, originalTarget) {\r\n    if(element) {\r\n        let type = typeof element;\r\n\r\n        if(type === 'function') {\r\n            return new Rect(element.call(dragInstance, target, originalTarget, dragInstance));\r\n        } else if(type === 'string') {\r\n            return new Rect(document.querySelector(element));\r\n        }\r\n\r\n        return new Rect(element);\r\n    }\r\n\r\n    return null;\r\n}\r\n\r\n\r\n/**\r\n * Returns the first scrollable parent.\r\n *\r\n * @param element\r\n * @returns {HTMLElement|null}\r\n * @private\r\n */\r\nfunction _getScrollParent(element) {\r\n    let o = element.parentElement;\r\n\r\n    while(o) {\r\n        if (o.scrollWidth > o.clientWidth || o.scrollHeight > o.clientHeight) {\r\n            return o;\r\n        }\r\n\r\n        o = o.parentElement;\r\n    }\r\n\r\n    return null;\r\n}\r\n\r\n\r\nfunction _getScrollRect(element) {\r\n    if(element === window || element.nodeName === \"HTML\") {\r\n        return new Rect(0, 0, window.innerWidth, window.innerHeight);\r\n    } else {\r\n        return new Rect(element);\r\n    }\r\n}\r\n\r\n\r\n/**\r\n * Helper class that is used to control scrolling when the element is dragged outside of bounds.\r\n */\r\nclass ScrollHelper {\r\n    constructor(element, scrollXSpeed=0, scrollYSpeed=0, onFrame=null) {\r\n        this.frameID = null;\r\n        this.element = element;\r\n        this.scrollXSpeed = scrollXSpeed;\r\n        this.scrollYSpeed = scrollYSpeed;\r\n        this.onFrame = onFrame;\r\n        this.timestamp = performance.now();\r\n\r\n        let frame = timestamp => {\r\n            let delta = (timestamp - this.timestamp) / 1000;\r\n\r\n            this.timestamp = timestamp;\r\n\r\n            this.element.scrollLeft += delta * this.scrollXSpeed;\r\n            this.element.scrollTop += delta * this.scrollYSpeed;\r\n\r\n            if(this.onFrame) {\r\n                this.onFrame(this);\r\n            }\r\n\r\n            this.frameID = window.requestAnimationFrame(frame);\r\n        };\r\n\r\n        this.frameID = window.requestAnimationFrame(frame);\r\n    }\r\n\r\n    cancel() {\r\n        if(this.frameID) {\r\n            window.cancelAnimationFrame(this.frameID);\r\n            this.frameID = null;\r\n        }\r\n    }\r\n\r\n    static getScrollSpeed(rect, scrollParentRect) {\r\n        let r = {x: 0, y: 0};\r\n\r\n        if(rect.right > scrollParentRect.right) {\r\n            r.x = clamp((rect.right - scrollParentRect.right) / rect.width, -1, 1);\r\n        } else if(rect.left < scrollParentRect.left) {\r\n            r.x = clamp((rect.left - scrollParentRect.left) / rect.width, -1, 1);\r\n        }\r\n\r\n        if(rect.bottom > scrollParentRect.bottom) {\r\n            r.y = clamp((rect.bottom - scrollParentRect.bottom) / rect.width, -1, 1);\r\n        } else if(rect.top < scrollParentRect.top) {\r\n            r.y = clamp((rect.top - scrollParentRect.top) / rect.width, -1, 1);\r\n        }\r\n\r\n        return r;\r\n    }\r\n\r\n    static buildScrollHelper(element, target, rect, pos, dragInstance, event, scrollSpeed, container) {\r\n        let scrollParent = _getScrollParent(element);\r\n\r\n        if(scrollParent) {\r\n            let scrollParentRect = _getScrollRect(scrollParent),\r\n                speed = ScrollHelper.getScrollSpeed(rect, scrollParentRect);\r\n\r\n            if(speed.x || speed.y) {\r\n                return new ScrollHelper(scrollParent, speed.x * scrollSpeed, speed.y * scrollSpeed, (scroller) => {\r\n                    let rect = _moveElementToPosition(this, target, event.clientX, event.clientY, pos.offsetX, pos.offsetY, _selectElementRect(container, dragInstance, target, element));\r\n\r\n                    let scrollRect = new Rect(scroller.element);\r\n\r\n                    setElementClientPosition(target, rect, 'translate3d');\r\n\r\n                    if(scrollRect.contains(rect)) {\r\n                        scroller.cancel();\r\n                        scroller = null;\r\n                    }\r\n                });\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\n\r\nexport function ScrollArea(selector) {\r\n    return function() {\r\n        let element = selector;\r\n\r\n        if(typeof element === 'string') {\r\n            element = document.querySelector(element);\r\n        }\r\n\r\n        let rect = new Rect(element),\r\n            scroll = getScroll(element);\r\n\r\n        rect.left -= scroll.scrollLeft;\r\n        rect.top -= scroll.scrollTop;\r\n        rect.right = rect.left + element.scrollWidth;\r\n        rect.bottom = rect.top + element.scrollHeight;\r\n\r\n        return rect;\r\n    }\r\n}\r\n\r\n\r\nexport function clone(opacity=null, className=null, zIndex=null) {\r\n    if(typeof opacity === 'object' && opacity.nodeType) {\r\n        return opacity.cloneNode(true);\r\n    }\r\n\r\n    return function(element) {\r\n        let r = element.cloneNode(true);\r\n\r\n        if(opacity !== null) {\r\n            r.style.opacity = opacity;\r\n        }\r\n\r\n        if(className) {\r\n            r.className = className;\r\n        }\r\n\r\n        r.style.position = \"absolute\";\r\n        if(zIndex !== null) r.style.zIndex = zIndex;\r\n\r\n        return r;\r\n    }\r\n}\r\n\r\n\r\nfunction publishDragMoveEvent(self, element, helper, event, rect, bubbles=false, options=null) {\r\n    return dispatchDropEvent(self, 'drag.move', element, helper, event, rect, bubbles, true, true, options);\r\n}\r\n\r\n\r\nfunction publishDragDropEvent(self, element, helper, event, rect, bubbles=true, options=null) {\r\n    return dispatchDropEvent(self, 'drag.drop', element, helper, event, rect, bubbles, true, true, options);\r\n}\r\n\r\n\r\nfunction dispatchDropEvent(self, name, element, helper, originalEvent, currentRect, bubbles=false, dispatch=true, publish=false, detail=null, target=null) {\r\n    let eventPackage = {\r\n        name,\r\n        draggable: self,\r\n        target: helper,\r\n        element,\r\n        item: element, // alias for element\r\n        helper: helper,\r\n        originalEvent: null,\r\n        rect: currentRect\r\n    };\r\n\r\n    if(originalEvent) {\r\n        eventPackage.originalEvent = originalEvent;\r\n        eventPackage.clientX = originalEvent.clientX;\r\n        eventPackage.clientY = originalEvent.clientY;\r\n    }\r\n\r\n    if(!target) {\r\n        target = element;\r\n    }\r\n\r\n    if(detail) {\r\n        Object.assign(eventPackage, detail);\r\n    }\r\n\r\n    if(publish) {\r\n        self.publish(name, eventPackage);\r\n    }\r\n\r\n    if(dispatch) {\r\n        let customEvent = new CustomEvent(name, {\r\n            bubbles,\r\n            detail: eventPackage\r\n        });\r\n\r\n        target.dispatchEvent(customEvent);\r\n    }\r\n}\r\n","import {getTranslation, setElementClientPosition} from \"core/ui/position\";\r\nimport Draggable, {cursor} from './Draggable';\r\n\r\n\r\nexport function placeholder(className, nodeName=null) {\r\n    return function(element) {\r\n        let placeholder = document.createElement(nodeName || element.nodeName),\r\n            box = element.getBoundingClientRect();\r\n\r\n        placeholder.style.boxSizing = \"border-box\";\r\n        box.style.width = `${box.width}px`;\r\n        box.style.height = `${box.height}px`;\r\n\r\n        if(className) {\r\n            placeholder.className = className;\r\n        }\r\n    }\r\n}\r\n\r\n\r\n/**\r\n * Creates a sortable list of items.\r\n */\r\nexport default class Sortable {\r\n    #draggable;\r\n\r\n    constructor(element, {items=\".ui-sort-item\", placeholder=null, layout='y', dropOnEmpty=true, accepts=null, setPlaceholderSize=false,\r\n        container=null, axis='xy', exclude=null, delay=null, offset=cursor,\r\n        resistance=null, handle=null, helper=null, revert=null, revertDuration, scrollSpeed=null, tolerance=0.5,\r\n        setHelperSize=false, grid=null, droppables=null}={}) {\r\n\r\n        if(typeof element === 'string') {\r\n            this.element = document.querySelector(element);\r\n        } else {\r\n            this.element = element;\r\n        }\r\n\r\n        this.#draggable = new Draggable(this.element, {container, axis, exclude, delay, offset, resistance, handle, helper, revert, revertDuration, scrollSpeed, selector: items, tolerance, setHelperSize, grid});\r\n\r\n        if(droppables) {\r\n            this.connect(droppables);\r\n        }\r\n\r\n        this.items = items;\r\n        this.layout = layout;\r\n        this.placeholder = placeholder;\r\n        this.dropOnEmpty = dropOnEmpty;\r\n        this.accepts = accepts;\r\n        this.setPlaceholderSize = setPlaceholderSize;\r\n\r\n        this.initEvents();\r\n    }\r\n\r\n    connect(droppables) {\r\n        this.#draggable.connect(droppables);\r\n    }\r\n\r\n    disconnect(droppables) {\r\n        this.#draggable.disconnect(droppables);\r\n    }\r\n\r\n    hasDroppable(droppable) {\r\n        return this.#draggable.hasDroppable(droppable);\r\n    }\r\n\r\n    get droppables() {\r\n        return this.#draggable.droppables;\r\n    }\r\n\r\n    /**\r\n     * Initializes event listeners.\r\n     */\r\n    initEvents() {\r\n        let placeholder,\r\n            isOver = false,\r\n            init = false,\r\n            target;\r\n\r\n        // Attaches temporary events when drag starts.\r\n        let initialize = (event) => {\r\n            init = true;\r\n            target = event.detail.item;\r\n            target.addEventListener('drag.move', onDragMove);\r\n            target.addEventListener('drag.end', onDragComplete);\r\n            target.addEventListener('sort-append', onSortAppend);\r\n            let startBB = target.getBoundingClientRect();\r\n            target.classList.add('ui-sorting');\r\n\r\n            if(!placeholder && this.placeholder) {\r\n                if(typeof this.placeholder === 'string') {\r\n                    placeholder = document.createElement(target.nodeName);\r\n                    placeholder.className = this.placeholder;\r\n                } else if(typeof this.placeholder === 'function') {\r\n                    placeholder = this.placeholder(target, this);\r\n                } else if(this.placeholder === true) {\r\n                    placeholder = document.createElement(target.nodeName);\r\n                } else {\r\n                    placeholder = this.placeholder;\r\n                }\r\n\r\n                placeholder.classList.add('ui-placeholder');\r\n\r\n                if(this.setPlaceholderSize) {\r\n                    if(this.setPlaceholderSize === true) {\r\n                        placeholder.style.width = `${startBB.width}px`;\r\n                        placeholder.style.height = `${startBB.height}px`;\r\n                        placeholder.style.boxSizing = 'border-box';\r\n                    } else if(Array.isArray(this.setPlaceholderSize)) {\r\n                        placeholder.style.width = `${this.setPlaceholderSize[0]}px`;\r\n                        placeholder.style.height = `${this.setPlaceholderSize[1]}px`;\r\n                    } else {\r\n                        placeholder.style.width = `${this.setPlaceholderSize.width}px`;\r\n                        placeholder.style.height = `${this.setPlaceholderSize.height}px`;\r\n                    }\r\n                }\r\n\r\n                if(this.element.contains(target)) {\r\n                    target.parentElement.insertBefore(placeholder, target);\r\n                }\r\n            }\r\n\r\n            setElementClientPosition(target, startBB, 'translate3d');\r\n        };\r\n\r\n        // Cleanup after sorting finishes.\r\n        let destroy = () => {\r\n            if(target) {\r\n                target.removeEventListener('drag.move', onDragMove);\r\n                target.removeEventListener('drag.end', onDragComplete);\r\n                target.removeEventListener('sort-append', onSortAppend);\r\n                init = false;\r\n                isOver = false;\r\n\r\n                if(placeholder && placeholder.parentElement) {\r\n                    placeholder.parentElement.removeChild(placeholder);\r\n                }\r\n\r\n                placeholder = null;\r\n\r\n                target.style.transform = \"\";\r\n                target.classList.remove('ui-sorting');\r\n                target = null;\r\n            }\r\n        };\r\n\r\n        // Ensures that the placeholder is removed if the item gets moves to another sortable.\r\n        let onSortAppend = event => {\r\n            if(event.detail !== this && placeholder && placeholder.parentElement) {\r\n                placeholder.parentElement.removeChild(placeholder);\r\n            }\r\n        };\r\n\r\n        // Moves the item to the correct position on mouse move.\r\n        let onDragMove = (event) => {\r\n            if(!isOver || (this.accepts && !event.detail.item.matches(this.accepts))) {\r\n                return;\r\n            }\r\n\r\n            let target = event.detail.item,\r\n                items = Array.prototype.slice.call(this.getItems()).filter(i => i !== target);\r\n\r\n            let before = this.getItemBeforePoint(event.detail.clientX, event.detail.clientY, items),\r\n                after = this.getItemAfterPoint(event.detail.clientX, event.detail.clientY, items),\r\n                beforeBB = event.detail.helper.getBoundingClientRect(),\r\n                dropOnEmpty = target.dataset.dropOnEmpty !== null && target.dataset.dropOnEmpty !== undefined ? target.dataset.dropOnEmpty === 'true' : this.dropOnEmpty; // Allow overriding on item level.\r\n\r\n            if(!items.length) {\r\n                if(dropOnEmpty) {\r\n                    this.element.appendChild(target);\r\n                    if(placeholder) target.parentElement.insertBefore(placeholder, target);\r\n                    this._refreshPositions(event.detail.helper, beforeBB);\r\n                    this._triggerSortAppendEvent(target);\r\n                }\r\n            } else if(before && before !== target) {\r\n                before.parentElement.insertBefore(target, before.nextSibling);\r\n                if(placeholder) target.parentElement.insertBefore(placeholder, target);\r\n                this._refreshPositions(event.detail.helper, beforeBB);\r\n                this._triggerSortAppendEvent(target);\r\n            } else if(after && after !== target) {\r\n                after.parentElement.insertBefore(target, after);\r\n                if(placeholder) target.parentElement.insertBefore(placeholder, target);\r\n                this._refreshPositions(event.detail.helper, beforeBB);\r\n                this._triggerSortAppendEvent(target);\r\n            }\r\n        };\r\n\r\n        // Cleanup\r\n        let onDragComplete = () => {\r\n            destroy();\r\n        };\r\n\r\n        // Initialize sorting.\r\n        this.element.addEventListener('drag.enter', event => {\r\n            if(this.accepts && !event.detail.item.matches(this.accepts)) {\r\n                return;\r\n            }\r\n\r\n            isOver = true;\r\n\r\n            if(!init) {\r\n                initialize(event);\r\n            }\r\n        });\r\n\r\n        // Mark isOver state false.\r\n        this.element.addEventListener('drag.leave', () => {\r\n            isOver = false;\r\n        });\r\n\r\n        // Initialize sorting that started on another sortable.\r\n        this.element.addEventListener('drag.start', (event) => {\r\n            if(!init) {\r\n                initialize(event);\r\n            }\r\n\r\n            isOver = true;\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Tests to see if the given (x, y) point is before or after the element.  Uses layout to determine if the test\r\n     * is for the x layout, the y layout or the xy layout.\r\n     * @param element\r\n     * @param x\r\n     * @param y\r\n     * @returns {string|null}\r\n     */\r\n    getRelativePosition(element, x, y) {\r\n        let box = element.getBoundingClientRect(),\r\n            mx = box.left + (box.width / 2),\r\n            my = box.top + (box.height / 2);\r\n\r\n        if(this.layout === 'x') {\r\n            return mx < x ? 'after' : 'before';\r\n        } else if(this.layout === 'y') {\r\n            return my < y ? 'after' : 'before';\r\n        } else if(this.layout === 'xy') {\r\n            return (box.bottom < y) || (mx < x && box.bottom >= y && box.top <= y) ? 'after' : 'before';\r\n        }\r\n\r\n        return null;\r\n    }\r\n\r\n    /**\r\n     * Returns the item immediately before the given x, y point.\r\n     * @param x\r\n     * @param y\r\n     * @param items\r\n     * @returns {*}\r\n     */\r\n    getItemBeforePoint(x, y, items) {\r\n        if(!items) items = this.getItems();\r\n\r\n        let r = null;\r\n\r\n        for(let i = 0; i < items.length; i++) {\r\n            let item = items[i];\r\n\r\n            if(this.getRelativePosition(item, x, y) === 'after') {\r\n                r = item;\r\n            } else {\r\n                break;\r\n            }\r\n        }\r\n\r\n        if(r) {\r\n            let box = r.getBoundingClientRect();\r\n\r\n            if((this.layout === 'x' || this.layout === 'xy') && box.top <= y && box.bottom >= y) {\r\n                return r;\r\n            } else if(this.layout === 'y' && box.left <= x && box.right >= x) {\r\n                return r;\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Returns the item immediately after the given (x, y) point.\r\n     * @param x\r\n     * @param y\r\n     * @param items\r\n     * @returns {null|*}\r\n     */\r\n    getItemAfterPoint(x, y, items) {\r\n        if(!items) items = this.getItems();\r\n\r\n        let r = null;\r\n\r\n        for(let i = items.length - 1; i >= 0; i--) {\r\n            let item = items[i];\r\n\r\n            if(this.getRelativePosition(item, x, y) === 'before') {\r\n                r = item;\r\n            } else {\r\n                break;\r\n            }\r\n        }\r\n\r\n        if(r) {\r\n            let box = r.getBoundingClientRect();\r\n\r\n            if((this.layout === 'x' || this.layout === 'xy') && box.top <= y && box.bottom >= y) {\r\n                return r;\r\n            } else if(this.layout === 'y' && box.left <= x && box.right >= x) {\r\n                return r;\r\n            }\r\n        }\r\n\r\n        return null;\r\n    }\r\n\r\n    /**\r\n     * Returns a list of all items for the sortable.\r\n     * @returns {NodeListOf<SVGElementTagNameMap[string]> | NodeListOf<HTMLElementTagNameMap[string]> | NodeListOf<Element>}\r\n     */\r\n    getItems() {\r\n        return this.element.querySelectorAll(this.items);\r\n    }\r\n\r\n    /**\r\n     * helper method that translates the target to the provided client position.\r\n     * @param target {{getBoundingClientRect, style} | Element}\r\n     * @param position {{left[Number], top[Number]}}\r\n     * @private\r\n     */\r\n    _refreshPositions(target, position) {\r\n        let current = target.getBoundingClientRect(),\r\n            deltaLeft = current.left - position.left,\r\n            deltaTop = current.top - position.top,\r\n            translation = getTranslation(target);\r\n\r\n        target.style.transform = `translate3d(${translation.x - deltaLeft}px, ${translation.y - deltaTop}px, 0)`;\r\n    }\r\n\r\n    /**\r\n     * Triggers the default sort-append event on the target.\r\n     * @param target {Element}\r\n     * @private\r\n     */\r\n    _triggerSortAppendEvent(target) {\r\n        let event = new CustomEvent('sort-append', {\r\n            bubbles: false,\r\n            detail: this\r\n        });\r\n\r\n        target.dispatchEvent(event);\r\n    }\r\n}\r\n"],"sourceRoot":""}