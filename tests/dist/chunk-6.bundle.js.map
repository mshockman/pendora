{"version":3,"sources":["webpack://pendora/./src/core/ui/PanesView.js","webpack://pendora/./tests/src/test_panes.js"],"names":["symbolPane","Symbol","getClosestPaneController","element","parentElement","PaneView","axis","Error","dataset","addEventListener","event","handle","target","closest","_startResizing","cancelResizing","targetChild","getTargetChild","stopPropagation","mouse","x","clientX","y","clientY","delta","startMousePos","startingData","getPaneData","index","findIndex","item","next","current","pane","rangeFindItem","document","preventDefault","maxShrink","maxGrow","amount","Math","min","rect","width","minWidth","maxWidth","clamp","window","cancelAnimationFrame","requestAnimationFrame","style","height","minHeight","maxHeight","removeEventListener","node","r","children","child","getComputedStyle","Rect","push","parseFloat","Infinity","Component","AutoLoader","register","PanesTestPage"],"mappings":"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","file":"chunk-6.bundle.js","sourcesContent":["import Component from \"../Component\";\r\nimport Rect from \"../vectors/Rect\";\r\nimport {clamp, rangeFindItem} from \"../utility\";\r\nimport AutoLoader from \"../../autoloader\";\r\n\r\n\r\nconst symbolPane = Symbol('pane');\r\n\r\n\r\nfunction getClosestPaneController(element) {\r\n    while(element) {\r\n        if(element[symbolPane]) {\r\n            return element[symbolPane];\r\n        } else {\r\n            element = element.parentElement;\r\n        }\r\n    }\r\n\r\n    return null;\r\n}\r\n\r\n\r\n/**\r\n * Creates a resizable pane view.\r\n */\r\nexport default class PaneView extends Component {\r\n    #onMouseMove;\r\n    #onMouseMoveTarget;\r\n    #onMouseUp;\r\n    #axis;\r\n    #frameID;\r\n\r\n    constructor(element, axis='x') {\r\n        super(element);\r\n\r\n        if(this.element[symbolPane]) {\r\n            throw new Error(\"Can only initialize one pane controller per element.\")\r\n        }\r\n\r\n        this.#onMouseMove = null;\r\n        this.#onMouseMoveTarget = null;\r\n        this.#onMouseUp = null;\r\n        this.#axis = this.element.dataset.axis || axis;\r\n        this.#frameID = null;\r\n        this.element[symbolPane] = this;\r\n\r\n        this.element.addEventListener('mousedown', event=> {\r\n            let handle = event.target.closest('[data-handle]');\r\n\r\n            if(handle && getClosestPaneController(handle) === this) {\r\n                this._startResizing(event);\r\n            }\r\n        });\r\n    }\r\n\r\n    _startResizing(event) {\r\n        if(this.#onMouseMove) {\r\n            this.cancelResizing();\r\n        }\r\n\r\n        let targetChild = this.getTargetChild(event.target);\r\n        event.stopPropagation();\r\n\r\n        let mouse = {x: event.clientX, y: event.clientY},\r\n            delta = {x: 0, y: 0},\r\n            startMousePos = {...mouse},\r\n            startingData = this.getPaneData(),\r\n            index = startingData.findIndex(item => item.element === targetChild),\r\n            next, current = startingData[index];\r\n\r\n        if(!current.pane) {\r\n            current = rangeFindItem(startingData, item => item.pane, index, 0);\r\n            next = rangeFindItem(startingData, item => item.pane, index+1, null);\r\n        } else {\r\n            if(current.pane === '-x' || current.pane === '-y' || current.pane === '-') {\r\n                next = rangeFindItem(startingData, item => item.pane, index-1, 0);\r\n            } else {\r\n                next = rangeFindItem(startingData, item => item.pane, index+1, null);\r\n            }\r\n        }\r\n\r\n        this.#onMouseMoveTarget = document;\r\n\r\n        this.#onMouseMove = event => {\r\n            event.preventDefault();\r\n            mouse.x = event.clientX;\r\n            mouse.y = event.clientY;\r\n\r\n            delta = {\r\n                x: mouse.x - startMousePos.x,\r\n                y: mouse.y - startMousePos.y\r\n            };\r\n\r\n            if(this.#axis === 'x') {\r\n                let x = current.pane === '-x' || current.pane === '-' ? -delta.x : delta.x,\r\n                    maxShrink,\r\n                    maxGrow, amount;\r\n\r\n                maxShrink = Math.min(current.rect.width - current.minWidth, next.maxWidth - next.rect.width);\r\n                maxGrow = Math.min(current.maxWidth - current.rect.width, next.rect.width - next.minWidth);\r\n                amount = clamp(x, -maxShrink, maxGrow);\r\n\r\n                if(this.#frameID) {\r\n                    window.cancelAnimationFrame(this.#frameID);\r\n                    this.#frameID = null;\r\n                }\r\n\r\n                this.#frameID = window.requestAnimationFrame(() => {\r\n                    this.#frameID = null;\r\n                    if(current.pane !== \"fluid\") current.element.style.width = `${current.rect.width + amount}px`;\r\n                    if(next.pane !== \"fluid\") next.element.style.width = `${next.rect.width - amount}px`;\r\n                });\r\n            } else {\r\n                let y = current.pane === '-y' || current.pane === '-' ? -delta.y : delta.y,\r\n                    maxShrink,\r\n                    maxGrow, amount;\r\n\r\n                maxShrink = Math.min(current.rect.height - current.minHeight, next.maxHeight - next.rect.height);\r\n                maxGrow = Math.min(current.maxHeight - current.rect.height, next.rect.height - next.minHeight);\r\n                amount = clamp(y, -maxShrink, maxGrow);\r\n\r\n                if(this.#frameID) {\r\n                    window.cancelAnimationFrame(this.#frameID);\r\n                    this.#frameID = null;\r\n                }\r\n\r\n                this.#frameID = window.requestAnimationFrame(() => {\r\n                    this.#frameID = null;\r\n                    if(current.pane !== \"fluid\") current.element.style.height = `${current.rect.height + amount}px`;\r\n                    if(next.pane !== \"fluid\") next.element.style.height = `${next.rect.height - amount}px`;\r\n                });\r\n            }\r\n        };\r\n\r\n        this.#onMouseUp = () => {\r\n            this.cancelResizing();\r\n        };\r\n\r\n        this.#onMouseMoveTarget.addEventListener('mousemove', this.#onMouseMove);\r\n        this.#onMouseMoveTarget.addEventListener('mouseup', this.#onMouseUp);\r\n    }\r\n\r\n    cancelResizing() {\r\n        if(this.#onMouseMove) {\r\n            this.#onMouseMoveTarget.removeEventListener('mousemove', this.#onMouseMove);\r\n            this.#onMouseMoveTarget.removeEventListener('mouseup', this.#onMouseUp);\r\n            this.#onMouseMoveTarget = null;\r\n            this.#onMouseMove = null;\r\n            this.#onMouseUp = null;\r\n        }\r\n    }\r\n\r\n    getTargetChild(element) {\r\n        let node = element;\r\n\r\n        while(node.parentElement) {\r\n            if(node.parentElement === this.element) {\r\n                return node;\r\n            }\r\n\r\n            node = node.parentElement;\r\n        }\r\n\r\n        return null;\r\n    }\r\n\r\n    getPaneData() {\r\n        let r = [];\r\n\r\n        for(let child of this.element.children) {\r\n            let style = getComputedStyle(child),\r\n                rect = new Rect(child);\r\n\r\n            r.push({\r\n                maxWidth: parseFloat(style.maxWidth) || Infinity,\r\n                maxHeight: parseFloat(style.maxHeight) || Infinity,\r\n                minWidth: parseFloat(style.minWidth) || 0,\r\n                minHeight: parseFloat(style.minHeight) || 0,\r\n                rect,\r\n                element: child,\r\n                pane: child.dataset.pane\r\n            });\r\n        }\r\n\r\n        return r;\r\n    }\r\n}\r\n\r\n\r\nAutoLoader.register('panes', element => {\r\n    return new PaneView(element, element.dataset.axis || 'x');\r\n});\r\n","import \"../../src/core/ui/PanesView\";\r\n\r\n\r\nexport default class PanesTestPage {\r\n    // noinspection JSUnusedGlobalSymbols\r\n    constructor() {\r\n\r\n    }\r\n\r\n    // noinspection JSUnusedGlobalSymbols\r\n    load() {\r\n\r\n    }\r\n}\r\n"],"sourceRoot":""}